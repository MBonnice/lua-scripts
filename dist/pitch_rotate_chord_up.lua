local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.RequireSelection=true;finaleplugin.Author="Nick Mazuk"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.0.1"finaleplugin.Date="March 30, 2021"finaleplugin.CategoryTags="Pitch"finaleplugin.AuthorURL="https://nickmazuk.com"return"Rotate Chord Up","Rotate Chord Up","Rotates the chord upwards, taking the bottom note and moving it above the rest of the chord"end;local o=require("library.transposition")local p=require("library.note_entry")function pitch_rotate_chord_up()for q in eachentrysaved(finenv.Region())do if q.Count>=2 then local r=p.calc_spans_number_of_octaves(q)local s=q:CalcHighestNote(nil)local t=q:CalcLowestNote(nil)o.change_octave(t,math.max(1,r))if s:IsIdenticalPitch(t)and q.Count>2 then local u=q:CalcLowestNote(nil)t.Displacement=u.Displacement;t.RaiseLower=u.RaiseLower;o.change_octave(t,math.max(1,r))end end end end;pitch_rotate_chord_up()end)c("library.note_entry",function(require,n,c,d)local v={}function v.finale_version(w,x,y)local z=bit32.bor(bit32.lshift(math.floor(w),24),bit32.lshift(math.floor(x),20))if y then z=bit32.bor(z,math.floor(y))end;return z end;function v.group_overlaps_region(A,B)if B:IsFullDocumentSpan()then return true end;local C=false;local D=finale.FCSystemStaves()D:LoadAllForRegion(B)for E in each(D)do if A:ContainsStaff(E:GetStaff())then C=true;break end end;if not C then return false end;if A.StartMeasure>B.EndMeasure or A.EndMeasure<B.StartMeasure then return false end;return true end;function v.group_is_contained_in_region(A,B)if not B:IsStaffIncluded(A.StartStaff)then return false end;if not B:IsStaffIncluded(A.EndStaff)then return false end;return true end;function v.staff_group_is_multistaff_instrument(A)local F=finale.FCMultiStaffInstruments()F:LoadAll()for G in each(F)do if G:ContainsStaff(A.StartStaff)and G.GroupID==A:GetItemID()then return true end end;return false end;function v.get_selected_region_or_whole_doc()local H=finenv.Region()if H:IsEmpty()then H:SetFullDocument()end;return H end;function v.get_first_cell_on_or_after_page(I)local J=I;local K=finale.FCPage()local L=false;while K:Load(J)do if K:GetFirstSystem()>0 then L=true;break end;J=J+1 end;if L then local M=finale.FCStaffSystem()M:Load(K:GetFirstSystem())return finale.FCCell(M.FirstMeasure,M.TopStaff)end;local N=finale.FCMusicRegion()N:SetFullDocument()return finale.FCCell(N.EndMeasure,N.EndStaff)end;function v.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local O=finale.FCMusicRegion()O:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),O.StartStaff)end;return v.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function v.get_top_left_selected_or_visible_cell()local H=finenv.Region()if not H:IsEmpty()then return finale.FCCell(H.StartMeasure,H.StartStaff)end;return v.get_top_left_visible_cell()end;function v.is_default_measure_number_visible_on_cell(P,Q,R,S)local T=finale.FCCurrentStaffSpec()if not T:LoadForCell(Q,0)then return false end;if P:GetShowOnTopStaff()and Q.Staff==R.TopStaff then return true end;if P:GetShowOnBottomStaff()and Q.Staff==R:CalcBottomStaff()then return true end;if T.ShowMeasureNumbers then return not P:GetExcludeOtherStaves(S)end;return false end;function v.is_default_number_visible_and_left_aligned(P,Q,U,S,V)if P.UseScoreInfoForParts then S=false end;if V and P:GetShowOnMultiMeasureRests(S)then if finale.MNALIGN_LEFT~=P:GetMultiMeasureAlignment(S)then return false end elseif Q.Measure==U.FirstMeasure then if not P:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=P:GetStartAlignment(S)then return false end else if not P:GetShowMultiples(S)then return false end;if finale.MNALIGN_LEFT~=P:GetMultipleAlignment(S)then return false end end;return v.is_default_measure_number_visible_on_cell(P,Q,U,S)end;function v.update_layout(W,X)W=W or 1;X=X or false;local Y=finale.FCPage()if Y:Load(W)then Y:UpdateLayout(X)end end;function v.get_current_part()local Z=finale.FCParts()Z:LoadAll()return Z:GetCurrent()end;function v.get_page_format_prefs()local _=v.get_current_part()local a0=finale.FCPageFormatPrefs()local a1=false;if _:IsScore()then a1=a0:LoadScore()else a1=a0:LoadParts()end;return a0,a1 end;function v.get_smufl_metadata_file(a2)if not a2 then a2=finale.FCFontInfo()a2:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local a3=function(a4,a2)local a5=a4 .."/SMuFL/Fonts/"..a2.Name.."/"..a2.Name..".json"return io.open(a5,"r")end;local a6=""if finenv.UI():IsOnWindows()then a6=os.getenv("LOCALAPPDATA")else a6=os.getenv("HOME").."/Library/Application Support"end;local a7=a3(a6,a2)if nil~=a7 then return a7 end;local a8="/Library/Application Support"if finenv.UI():IsOnWindows()then a8=os.getenv("COMMONPROGRAMFILES")end;return a3(a8,a2)end;function v.is_font_smufl_font(a2)if not a2 then a2=finale.FCFontInfo()a2:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=v.finale_version(27,1)then if nil~=a2.IsSMuFLFont then return a2.IsSMuFLFont end end;local a9=v.get_smufl_metadata_file(a2)if nil~=a9 then io.close(a9)return true end;return false end;function v.simple_input(aa,ab)local ac=finale.FCString()ac.LuaString=""local ad=finale.FCString()local ae=160;function format_ctrl(af,ag,ah,ai)af:SetHeight(ag)af:SetWidth(ah)ad.LuaString=ai;af:SetText(ad)end;title_width=string.len(aa)*6+54;if title_width>ae then ae=title_width end;text_width=string.len(ab)*6;if text_width>ae then ae=text_width end;ad.LuaString=aa;local aj=finale.FCCustomLuaWindow()aj:SetTitle(ad)local ak=aj:CreateStatic(0,0)format_ctrl(ak,16,ae,ab)local al=aj:CreateEdit(0,20)format_ctrl(al,20,ae,"")aj:CreateOkButton()aj:CreateCancelButton()function callback(af)end;aj:RegisterHandleCommand(callback)if aj:ExecuteModal(nil)==finale.EXECMODAL_OK then ac.LuaString=al:GetText(ac)return ac.LuaString end end;function v.is_finale_object(am)return am and type(am)=="userdata"and am.ClassName and am.GetClassID and true or false end;function v.system_indent_set_to_prefs(U,a0)a0=a0 or v.get_page_format_prefs()local an=finale.FCMeasure()local ao=U.FirstMeasure==1;if not ao and an:Load(U.FirstMeasure)then if an.ShowFullNames then ao=true end end;if ao and a0.UseFirstSystemMargins then U.LeftMargin=a0.FirstSystemLeft else U.LeftMargin=a0.SystemLeft end;return U:Save()end;return v end)c("library.transposition",function(require,n,c,d)local v={}function v.finale_version(w,x,y)local z=bit32.bor(bit32.lshift(math.floor(w),24),bit32.lshift(math.floor(x),20))if y then z=bit32.bor(z,math.floor(y))end;return z end;function v.group_overlaps_region(A,B)if B:IsFullDocumentSpan()then return true end;local C=false;local D=finale.FCSystemStaves()D:LoadAllForRegion(B)for E in each(D)do if A:ContainsStaff(E:GetStaff())then C=true;break end end;if not C then return false end;if A.StartMeasure>B.EndMeasure or A.EndMeasure<B.StartMeasure then return false end;return true end;function v.group_is_contained_in_region(A,B)if not B:IsStaffIncluded(A.StartStaff)then return false end;if not B:IsStaffIncluded(A.EndStaff)then return false end;return true end;function v.staff_group_is_multistaff_instrument(A)local F=finale.FCMultiStaffInstruments()F:LoadAll()for G in each(F)do if G:ContainsStaff(A.StartStaff)and G.GroupID==A:GetItemID()then return true end end;return false end;function v.get_selected_region_or_whole_doc()local H=finenv.Region()if H:IsEmpty()then H:SetFullDocument()end;return H end;function v.get_first_cell_on_or_after_page(I)local J=I;local K=finale.FCPage()local L=false;while K:Load(J)do if K:GetFirstSystem()>0 then L=true;break end;J=J+1 end;if L then local M=finale.FCStaffSystem()M:Load(K:GetFirstSystem())return finale.FCCell(M.FirstMeasure,M.TopStaff)end;local N=finale.FCMusicRegion()N:SetFullDocument()return finale.FCCell(N.EndMeasure,N.EndStaff)end;function v.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local O=finale.FCMusicRegion()O:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),O.StartStaff)end;return v.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function v.get_top_left_selected_or_visible_cell()local H=finenv.Region()if not H:IsEmpty()then return finale.FCCell(H.StartMeasure,H.StartStaff)end;return v.get_top_left_visible_cell()end;function v.is_default_measure_number_visible_on_cell(P,Q,R,S)local T=finale.FCCurrentStaffSpec()if not T:LoadForCell(Q,0)then return false end;if P:GetShowOnTopStaff()and Q.Staff==R.TopStaff then return true end;if P:GetShowOnBottomStaff()and Q.Staff==R:CalcBottomStaff()then return true end;if T.ShowMeasureNumbers then return not P:GetExcludeOtherStaves(S)end;return false end;function v.is_default_number_visible_and_left_aligned(P,Q,U,S,V)if P.UseScoreInfoForParts then S=false end;if V and P:GetShowOnMultiMeasureRests(S)then if finale.MNALIGN_LEFT~=P:GetMultiMeasureAlignment(S)then return false end elseif Q.Measure==U.FirstMeasure then if not P:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=P:GetStartAlignment(S)then return false end else if not P:GetShowMultiples(S)then return false end;if finale.MNALIGN_LEFT~=P:GetMultipleAlignment(S)then return false end end;return v.is_default_measure_number_visible_on_cell(P,Q,U,S)end;function v.update_layout(W,X)W=W or 1;X=X or false;local Y=finale.FCPage()if Y:Load(W)then Y:UpdateLayout(X)end end;function v.get_current_part()local Z=finale.FCParts()Z:LoadAll()return Z:GetCurrent()end;function v.get_page_format_prefs()local _=v.get_current_part()local a0=finale.FCPageFormatPrefs()local a1=false;if _:IsScore()then a1=a0:LoadScore()else a1=a0:LoadParts()end;return a0,a1 end;function v.get_smufl_metadata_file(a2)if not a2 then a2=finale.FCFontInfo()a2:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local a3=function(a4,a2)local a5=a4 .."/SMuFL/Fonts/"..a2.Name.."/"..a2.Name..".json"return io.open(a5,"r")end;local a6=""if finenv.UI():IsOnWindows()then a6=os.getenv("LOCALAPPDATA")else a6=os.getenv("HOME").."/Library/Application Support"end;local a7=a3(a6,a2)if nil~=a7 then return a7 end;local a8="/Library/Application Support"if finenv.UI():IsOnWindows()then a8=os.getenv("COMMONPROGRAMFILES")end;return a3(a8,a2)end;function v.is_font_smufl_font(a2)if not a2 then a2=finale.FCFontInfo()a2:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=v.finale_version(27,1)then if nil~=a2.IsSMuFLFont then return a2.IsSMuFLFont end end;local a9=v.get_smufl_metadata_file(a2)if nil~=a9 then io.close(a9)return true end;return false end;function v.simple_input(aa,ab)local ac=finale.FCString()ac.LuaString=""local ad=finale.FCString()local ae=160;function format_ctrl(af,ag,ah,ai)af:SetHeight(ag)af:SetWidth(ah)ad.LuaString=ai;af:SetText(ad)end;title_width=string.len(aa)*6+54;if title_width>ae then ae=title_width end;text_width=string.len(ab)*6;if text_width>ae then ae=text_width end;ad.LuaString=aa;local aj=finale.FCCustomLuaWindow()aj:SetTitle(ad)local ak=aj:CreateStatic(0,0)format_ctrl(ak,16,ae,ab)local al=aj:CreateEdit(0,20)format_ctrl(al,20,ae,"")aj:CreateOkButton()aj:CreateCancelButton()function callback(af)end;aj:RegisterHandleCommand(callback)if aj:ExecuteModal(nil)==finale.EXECMODAL_OK then ac.LuaString=al:GetText(ac)return ac.LuaString end end;function v.is_finale_object(am)return am and type(am)=="userdata"and am.ClassName and am.GetClassID and true or false end;function v.system_indent_set_to_prefs(U,a0)a0=a0 or v.get_page_format_prefs()local an=finale.FCMeasure()local ao=U.FirstMeasure==1;if not ao and an:Load(U.FirstMeasure)then if an.ShowFullNames then ao=true end end;if ao and a0.UseFirstSystemMargins then U.LeftMargin=a0.FirstSystemLeft else U.LeftMargin=a0.SystemLeft end;return U:Save()end;return v end)return a("__root")