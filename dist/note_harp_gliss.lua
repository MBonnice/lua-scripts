local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.RequireSelection=true;finaleplugin.MinFinaleVersion="2012"finaleplugin.Author="Jari Williamsson"finaleplugin.Version="0.01"finaleplugin.Notes=[[
        This script will only process 7-tuplets that appears on staves that has been defined as "Harp" in the Score Manager.
    ]]finaleplugin.CategoryTags="Idiomatic, Note, Plucked Strings, Region, Tuplet, Woodwinds"return"Harp gliss","Harp gliss","Transforms 7-tuplets to harp gliss notation."end;local o=require("library.configuration")local p={stem_length=84,small_note_size=70}o.get_parameters("harp_gliss.config.txt",p)function change_beam_info(q,r)local s=r:CalcStemLength()q.Thickness=0;if r:CalcStemUp()then q.LeftVerticalOffset=q.LeftVerticalOffset+p.stem_length-s else q.LeftVerticalOffset=q.LeftVerticalOffset-p.stem_length+s end end;function change_primary_beam(r)local t=finale.FCPrimaryBeamMods(r)t:LoadAll()if t.Count>0 then local q=t:GetItemAt(0)change_beam_info(q,r)q:Save()else local q=finale.FCBeamMod(false)q:SetNoteEntry(r)change_beam_info(q,r)q:SaveNew()end end;function verify_entries(r,u)local v=finale.FCCurrentStaffSpec()v:LoadForEntry(r)if v.InstrumentUUID~=finale.FFUUID_HARP then return false end;local w=0;local x=r;for y=0,6 do if r==nil then return false end;if r:IsRest()then return false end;if r.Duration>=finale.QUARTER_NOTE then return false end;if r.Staff~=x.Staff then return false end;if r.Layer~=x.Layer then return false end;if r:CalcDots()>0 then return false end;w=w+r.Duration;r=r:Next()end;return w==u:CalcFullSymbolicDuration()end;function get_matching_tuplet(r)local z=r:CreateTuplets()for u in each(z)do if u.SymbolicNumber==7 and verify_entries(r,u)then return u end end;return nil end;function hide_tuplet(u)u.ShapeStyle=finale.TUPLETSHAPE_NONE;u.NumberStyle=finale.TUPLETNUMBER_NONE;u.Visible=false;u:Save()end;function hide_stems(r,u)local A=u:CalcFullReferenceDuration()>=finale.WHOLE_NOTE;for B=0,6 do if B>0 or A then local C=finale.FCCustomStemMod()C:SetNoteEntry(r)C:UseUpStemData(r:CalcStemUp())if C:LoadFirst()then C.ShapeID=0;C:Save()else C.ShapeID=0;C:SaveNew()end end;r=r:Next()end end;function set_noteheads(r,u)for B=0,6 do for D in each(r)do local E=finale.FCNoteheadMod()if B==0 then local F=u:CalcFullReferenceDuration()if F>=finale.WHOLE_NOTE then E.CustomChar=119 elseif F>=finale.HALF_NOTE then E.CustomChar=250 end else E.Resize=p.small_note_size end;E:SaveAt(D)end;r=r:Next()end end;function change_dotted_first_entry(r,u)local F=u:CalcFullReferenceDuration()local G=finale.FCNoteEntry.CalcDotsForDuration(F)local H=r:CalcDots()if G==0 then return end;if G>3 then return end;if H>0 then return end;local I=r:Next()local J=I.Duration/2;for y=1,G do r.Duration=r.Duration+J;I.Duration=I.Duration-J;J=J/2 end end;function harp_gliss()local K=false;for r in eachentrysaved(finenv.Region())do local L=get_matching_tuplet(r)if L then K=true;for B=1,6 do r=r:Next()r.BeamBeat=false end end end;if not K then return end;finale.FCNoteEntry.MarkEntryMetricsForUpdate()for r in eachentrysaved(finenv.Region())do local L=get_matching_tuplet(r)if L then change_dotted_first_entry(r,L)change_primary_beam(r)hide_tuplet(L)hide_stems(r,L)set_noteheads(r,L)end end end;harp_gliss()end)c("library.configuration",function(require,n,c,d)local M={}function M.finale_version(N,O,P)local Q=bit32.bor(bit32.lshift(math.floor(N),24),bit32.lshift(math.floor(O),20))if P then Q=bit32.bor(Q,math.floor(P))end;return Q end;function M.group_overlaps_region(R,S)if S:IsFullDocumentSpan()then return true end;local T=false;local U=finale.FCSystemStaves()U:LoadAllForRegion(S)for V in each(U)do if R:ContainsStaff(V:GetStaff())then T=true;break end end;if not T then return false end;if R.StartMeasure>S.EndMeasure or R.EndMeasure<S.StartMeasure then return false end;return true end;function M.group_is_contained_in_region(R,S)if not S:IsStaffIncluded(R.StartStaff)then return false end;if not S:IsStaffIncluded(R.EndStaff)then return false end;return true end;function M.staff_group_is_multistaff_instrument(R)local W=finale.FCMultiStaffInstruments()W:LoadAll()for X in each(W)do if X:ContainsStaff(R.StartStaff)and X.GroupID==R:GetItemID()then return true end end;return false end;function M.get_selected_region_or_whole_doc()local Y=finenv.Region()if Y:IsEmpty()then Y:SetFullDocument()end;return Y end;function M.get_first_cell_on_or_after_page(Z)local _=Z;local a0=finale.FCPage()local a1=false;while a0:Load(_)do if a0:GetFirstSystem()>0 then a1=true;break end;_=_+1 end;if a1 then local a2=finale.FCStaffSystem()a2:Load(a0:GetFirstSystem())return finale.FCCell(a2.FirstMeasure,a2.TopStaff)end;local a3=finale.FCMusicRegion()a3:SetFullDocument()return finale.FCCell(a3.EndMeasure,a3.EndStaff)end;function M.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local a4=finale.FCMusicRegion()a4:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),a4.StartStaff)end;return M.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function M.get_top_left_selected_or_visible_cell()local Y=finenv.Region()if not Y:IsEmpty()then return finale.FCCell(Y.StartMeasure,Y.StartStaff)end;return M.get_top_left_visible_cell()end;function M.is_default_measure_number_visible_on_cell(a5,a6,a7,a8)local a9=finale.FCCurrentStaffSpec()if not a9:LoadForCell(a6,0)then return false end;if a5:GetShowOnTopStaff()and a6.Staff==a7.TopStaff then return true end;if a5:GetShowOnBottomStaff()and a6.Staff==a7:CalcBottomStaff()then return true end;if a9.ShowMeasureNumbers then return not a5:GetExcludeOtherStaves(a8)end;return false end;function M.is_default_number_visible_and_left_aligned(a5,a6,aa,a8,ab)if a5.UseScoreInfoForParts then a8=false end;if ab and a5:GetShowOnMultiMeasureRests(a8)then if finale.MNALIGN_LEFT~=a5:GetMultiMeasureAlignment(a8)then return false end elseif a6.Measure==aa.FirstMeasure then if not a5:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=a5:GetStartAlignment(a8)then return false end else if not a5:GetShowMultiples(a8)then return false end;if finale.MNALIGN_LEFT~=a5:GetMultipleAlignment(a8)then return false end end;return M.is_default_measure_number_visible_on_cell(a5,a6,aa,a8)end;function M.update_layout(ac,ad)ac=ac or 1;ad=ad or false;local ae=finale.FCPage()if ae:Load(ac)then ae:UpdateLayout(ad)end end;function M.get_current_part()local af=finale.FCParts()af:LoadAll()return af:GetCurrent()end;function M.get_page_format_prefs()local ag=M.get_current_part()local ah=finale.FCPageFormatPrefs()local ai=false;if ag:IsScore()then ai=ah:LoadScore()else ai=ah:LoadParts()end;return ah,ai end;function M.get_smufl_metadata_file(aj)if not aj then aj=finale.FCFontInfo()aj:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local ak=function(al,aj)local am=al.."/SMuFL/Fonts/"..aj.Name.."/"..aj.Name..".json"return io.open(am,"r")end;local an=""if finenv.UI():IsOnWindows()then an=os.getenv("LOCALAPPDATA")else an=os.getenv("HOME").."/Library/Application Support"end;local ao=ak(an,aj)if nil~=ao then return ao end;local ap="/Library/Application Support"if finenv.UI():IsOnWindows()then ap=os.getenv("COMMONPROGRAMFILES")end;return ak(ap,aj)end;function M.is_font_smufl_font(aj)if not aj then aj=finale.FCFontInfo()aj:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=M.finale_version(27,1)then if nil~=aj.IsSMuFLFont then return aj.IsSMuFLFont end end;local aq=M.get_smufl_metadata_file(aj)if nil~=aq then io.close(aq)return true end;return false end;function M.simple_input(ar,as)local at=finale.FCString()at.LuaString=""local au=finale.FCString()local av=160;function format_ctrl(aw,ax,ay,az)aw:SetHeight(ax)aw:SetWidth(ay)au.LuaString=az;aw:SetText(au)end;title_width=string.len(ar)*6+54;if title_width>av then av=title_width end;text_width=string.len(as)*6;if text_width>av then av=text_width end;au.LuaString=ar;local aA=finale.FCCustomLuaWindow()aA:SetTitle(au)local aB=aA:CreateStatic(0,0)format_ctrl(aB,16,av,as)local aC=aA:CreateEdit(0,20)format_ctrl(aC,20,av,"")aA:CreateOkButton()aA:CreateCancelButton()function callback(aw)end;aA:RegisterHandleCommand(callback)if aA:ExecuteModal(nil)==finale.EXECMODAL_OK then at.LuaString=aC:GetText(at)return at.LuaString end end;function M.is_finale_object(aD)return aD and type(aD)=="userdata"and aD.ClassName and aD.GetClassID and true or false end;function M.system_indent_set_to_prefs(aa,ah)ah=ah or M.get_page_format_prefs()local aE=finale.FCMeasure()local aF=aa.FirstMeasure==1;if not aF and aE:Load(aa.FirstMeasure)then if aE.ShowFullNames then aF=true end end;if aF and ah.UseFirstSystemMargins then aa.LeftMargin=ah.FirstSystemLeft else aa.LeftMargin=ah.SystemLeft end;return aa:Save()end;return M end)return a("__root")