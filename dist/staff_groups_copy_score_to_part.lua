local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.Author="Robert Patterson"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.0"finaleplugin.Date="June 12, 2020"finaleplugin.CategoryTags="Staff"return"Group Copy Score to Part","Group Copy Score to Part","Copies any applicable groups from the score to the current part in view."end;local o=require("library.general_library")function set_draw_barline_mode(p,q)p.DrawBarlineMode=q.DrawBarlineMode;if p.DrawBarlineMode~=q.DrawBarlineMode then if q.DrawBarlineMode==finale.GROUPBARLINESTYLE_ONLYON then p.DrawBarlineMode=finale.GROUPBARLINESTYLE_ONLYBETWEEN elseif q.DrawBarlineMode==finale.GROUPBARLINESTYLE_ONLYBETWEEN then p.DrawBarlineMode=finale.GROUPBARLINESTYLE_ONLYON end end end;function staff_groups_copy_score_to_part()local r=finale.FCParts()r:LoadAll()local s=r:GetCurrent()if s:IsScore()then finenv.UI():AlertInfo("This script is only valid when viewing a part.","Not In Part View")return end;local t=finale.FCGroups()t:LoadAll()for u in each(t)do if not o.staff_group_is_multistaff_instrument(u)then u:DeleteData()end end;local v=r:GetScore()v:SwitchTo()local w=finale.FCGroups()w:LoadAll()for x in each(w)do local y=x.StartStaff;local z=x.EndStaff;if not o.staff_group_is_multistaff_instrument(x)then v:SwitchBack()if s:IsStaffIncluded(y)and s:IsStaffIncluded(z)then local p=finale.FCGroup()p.StartStaff=x.StartStaff;p.EndStaff=x.EndStaff;p.StartMeasure=x.StartMeasure;p.EndMeasure=x.EndMeasure;p.AbbreviatedNameAlign=x.AbbreviatedNameAlign;p.AbbreviatedNameExpandSingle=x.AbbreviatedNameExpandSingle;p.AbbreviatedNameHorizontalOffset=x.AbbreviatedNameHorizontalOffset;p.AbbreviatedNameJustify=x.AbbreviatedNameJustify;p.AbbreviatedNameVerticalOffset=x.AbbreviatedNameVerticalOffset;p.BarlineShapeID=x.BarlineShapeID;p.BarlineStyle=x.BarlineStyle;p.BarlineUse=x.BarlineUse;p.BracketHorizontalPos=x.BracketHorizontalPos;p.BracketSingleStaff=x.BracketSingleStaff;p.BracketStyle=x.BracketStyle;p.BracketVerticalBottomPos=x.BracketVerticalBottomPos;p.BracketVerticalTopPos=x.BracketVerticalTopPos;set_draw_barline_mode(p,x)p.EmptyStaffHide=x.EmptyStaffHide;p.FullNameAlign=x.FullNameAlign;p.FullNameExpandSingle=x.FullNameExpandSingle;p.FullNameHorizontalOffset=x.FullNameHorizontalOffset;p.FullNameJustify=x.FullNameJustify;p.FullNameVerticalOffset=x.FullNameVerticalOffset;p.ShowGroupName=x.ShowGroupName;p.UseAbbreviatedNamePositioning=x.UseAbbreviatedNamePositioning;p.UseFullNamePositioning=x.UseFullNamePositioning;if x.HasFullName and 0~=x:GetFullNameID()then p:SaveNewFullNameBlock(x:CreateFullNameString())end;if x.HasAbbreviatedName and 0~=x:GetAbbreviatedNameID()then p:SaveNewAbbreviatedNameBlock(x:CreateAbbreviatedNameString())end;p:SaveNew(0)end;v:SwitchTo()end end;v:SwitchBack()end;staff_groups_copy_score_to_part()end)c("library.general_library",function(require,n,c,d)local o={}function o.finale_version(A,B,C)local D=bit32.bor(bit32.lshift(math.floor(A),24),bit32.lshift(math.floor(B),20))if C then D=bit32.bor(D,math.floor(C))end;return D end;function o.group_overlaps_region(x,E)if E:IsFullDocumentSpan()then return true end;local F=false;local G=finale.FCSystemStaves()G:LoadAllForRegion(E)for H in each(G)do if x:ContainsStaff(H:GetStaff())then F=true;break end end;if not F then return false end;if x.StartMeasure>E.EndMeasure or x.EndMeasure<E.StartMeasure then return false end;return true end;function o.group_is_contained_in_region(x,E)if not E:IsStaffIncluded(x.StartStaff)then return false end;if not E:IsStaffIncluded(x.EndStaff)then return false end;return true end;function o.staff_group_is_multistaff_instrument(x)local I=finale.FCMultiStaffInstruments()I:LoadAll()for J in each(I)do if J:ContainsStaff(x.StartStaff)and J.GroupID==x:GetItemID()then return true end end;return false end;function o.get_selected_region_or_whole_doc()local K=finenv.Region()if K:IsEmpty()then K:SetFullDocument()end;return K end;function o.get_first_cell_on_or_after_page(L)local M=L;local N=finale.FCPage()local O=false;while N:Load(M)do if N:GetFirstSystem()>0 then O=true;break end;M=M+1 end;if O then local P=finale.FCStaffSystem()P:Load(N:GetFirstSystem())return finale.FCCell(P.FirstMeasure,P.TopStaff)end;local Q=finale.FCMusicRegion()Q:SetFullDocument()return finale.FCCell(Q.EndMeasure,Q.EndStaff)end;function o.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local R=finale.FCMusicRegion()R:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),R.StartStaff)end;return o.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function o.get_top_left_selected_or_visible_cell()local K=finenv.Region()if not K:IsEmpty()then return finale.FCCell(K.StartMeasure,K.StartStaff)end;return o.get_top_left_visible_cell()end;function o.is_default_measure_number_visible_on_cell(S,T,U,V)local W=finale.FCCurrentStaffSpec()if not W:LoadForCell(T,0)then return false end;if S:GetShowOnTopStaff()and T.Staff==U.TopStaff then return true end;if S:GetShowOnBottomStaff()and T.Staff==U:CalcBottomStaff()then return true end;if W.ShowMeasureNumbers then return not S:GetExcludeOtherStaves(V)end;return false end;function o.is_default_number_visible_and_left_aligned(S,T,X,V,Y)if S.UseScoreInfoForParts then V=false end;if Y and S:GetShowOnMultiMeasureRests(V)then if finale.MNALIGN_LEFT~=S:GetMultiMeasureAlignment(V)then return false end elseif T.Measure==X.FirstMeasure then if not S:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=S:GetStartAlignment(V)then return false end else if not S:GetShowMultiples(V)then return false end;if finale.MNALIGN_LEFT~=S:GetMultipleAlignment(V)then return false end end;return o.is_default_measure_number_visible_on_cell(S,T,X,V)end;function o.update_layout(Z,_)Z=Z or 1;_=_ or false;local a0=finale.FCPage()if a0:Load(Z)then a0:UpdateLayout(_)end end;function o.get_current_part()local r=finale.FCParts()r:LoadAll()return r:GetCurrent()end;function o.get_page_format_prefs()local s=o.get_current_part()local a1=finale.FCPageFormatPrefs()local a2=false;if s:IsScore()then a2=a1:LoadScore()else a2=a1:LoadParts()end;return a1,a2 end;function o.get_smufl_metadata_file(a3)if not a3 then a3=finale.FCFontInfo()a3:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local a4=function(a5,a3)local a6=a5 .."/SMuFL/Fonts/"..a3.Name.."/"..a3.Name..".json"return io.open(a6,"r")end;local a7=""if finenv.UI():IsOnWindows()then a7=os.getenv("LOCALAPPDATA")else a7=os.getenv("HOME").."/Library/Application Support"end;local a8=a4(a7,a3)if nil~=a8 then return a8 end;local a9="/Library/Application Support"if finenv.UI():IsOnWindows()then a9=os.getenv("COMMONPROGRAMFILES")end;return a4(a9,a3)end;function o.is_font_smufl_font(a3)if not a3 then a3=finale.FCFontInfo()a3:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=o.finale_version(27,1)then if nil~=a3.IsSMuFLFont then return a3.IsSMuFLFont end end;local aa=o.get_smufl_metadata_file(a3)if nil~=aa then io.close(aa)return true end;return false end;function o.simple_input(ab,ac)local ad=finale.FCString()ad.LuaString=""local ae=finale.FCString()local af=160;function format_ctrl(ag,ah,ai,aj)ag:SetHeight(ah)ag:SetWidth(ai)ae.LuaString=aj;ag:SetText(ae)end;title_width=string.len(ab)*6+54;if title_width>af then af=title_width end;text_width=string.len(ac)*6;if text_width>af then af=text_width end;ae.LuaString=ab;local ak=finale.FCCustomLuaWindow()ak:SetTitle(ae)local al=ak:CreateStatic(0,0)format_ctrl(al,16,af,ac)local am=ak:CreateEdit(0,20)format_ctrl(am,20,af,"")ak:CreateOkButton()ak:CreateCancelButton()function callback(ag)end;ak:RegisterHandleCommand(callback)if ak:ExecuteModal(nil)==finale.EXECMODAL_OK then ad.LuaString=am:GetText(ad)return ad.LuaString end end;function o.is_finale_object(an)return an and type(an)=="userdata"and an.ClassName and an.GetClassID and true or false end;function o.system_indent_set_to_prefs(X,a1)a1=a1 or o.get_page_format_prefs()local ao=finale.FCMeasure()local ap=X.FirstMeasure==1;if not ap and ao:Load(X.FirstMeasure)then if ao.ShowFullNames then ap=true end end;if ap and a1.UseFirstSystemMargins then X.LeftMargin=a1.FirstSystemLeft else X.LeftMargin=a1.SystemLeft end;return X:Save()end;return o end)return a("__root")