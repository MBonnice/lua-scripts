local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.Author="Nick Mazuk"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.1.0"finaleplugin.Date="September 2, 2021"finaleplugin.CategoryTags="Score"finaleplugin.AuthorURL="https://nickmazuk.com"finaleplugin.Notes=[[
        This script sets up a score for trombone octet - 6 tenors, 2 basses.

        To use it, first open your default document or document styles. Then, run the script.
        All existing staffs will be deleted. And in their place, the trombone octet will be created.

        This script uses the standard ensemble creation configuration options.
    ]]return"Create trombone choir score","Create trombone choir score","Creates the score setup correctly for trombone choir"end;local o=require("library.score")local p=require("library.configuration")local q=o.create_default_config()q.systems_per_page=2;q.large_measure_number_space="24s"p.get_parameters("score_create_trombone_choir_score.config.txt",q)local function r()o.reset_and_clear_score()local s={}s.trombone_1=o.create_staff("Trombone 1","Tbn. 1",finale.FFUUID_TROMBONE,"tenor")s.trombone_2=o.create_staff("Trombone 2","Tbn. 2",finale.FFUUID_TROMBONE,"tenor")s.trombone_3=o.create_staff("Trombone 3","Tbn. 3",finale.FFUUID_TROMBONE,"tenor")s.trombone_4=o.create_staff("Trombone 4","Tbn. 4",finale.FFUUID_TROMBONE,"bass")s.trombone_5=o.create_staff("Trombone 5","Tbn. 5",finale.FFUUID_TROMBONE,"bass")s.trombone_6=o.create_staff("Trombone 6","Tbn. 6",finale.FFUUID_TROMBONE,"bass")s.bass_trombone_1=o.create_staff("Bass Trombone 1","B. Tbn. 1",finale.FFUUID_BASSTROMBONE,"bass")s.bass_trombone_2=o.create_staff("Bass Trombone 2","B. Tbn. 2",finale.FFUUID_BASSTROMBONE,"bass")o.create_group_primary(s.trombone_1,s.bass_trombone_2)o.create_group_secondary(s.trombone_1,s.trombone_6)o.create_group_secondary(s.bass_trombone_1,s.bass_trombone_2)o.apply_config(q,{force_staves_show_time_signatures={s.trombone_1,s.trombone_5}})end;r()end)c("library.configuration",function(require,n,c,d)local t={}function t.finale_version(u,v,w)local x=bit32.bor(bit32.lshift(math.floor(u),24),bit32.lshift(math.floor(v),20))if w then x=bit32.bor(x,math.floor(w))end;return x end;function t.group_overlaps_region(y,z)if z:IsFullDocumentSpan()then return true end;local A=false;local B=finale.FCSystemStaves()B:LoadAllForRegion(z)for C in each(B)do if y:ContainsStaff(C:GetStaff())then A=true;break end end;if not A then return false end;if y.StartMeasure>z.EndMeasure or y.EndMeasure<z.StartMeasure then return false end;return true end;function t.group_is_contained_in_region(y,z)if not z:IsStaffIncluded(y.StartStaff)then return false end;if not z:IsStaffIncluded(y.EndStaff)then return false end;return true end;function t.staff_group_is_multistaff_instrument(y)local D=finale.FCMultiStaffInstruments()D:LoadAll()for E in each(D)do if E:ContainsStaff(y.StartStaff)and E.GroupID==y:GetItemID()then return true end end;return false end;function t.get_selected_region_or_whole_doc()local F=finenv.Region()if F:IsEmpty()then F:SetFullDocument()end;return F end;function t.get_first_cell_on_or_after_page(G)local H=G;local I=finale.FCPage()local J=false;while I:Load(H)do if I:GetFirstSystem()>0 then J=true;break end;H=H+1 end;if J then local K=finale.FCStaffSystem()K:Load(I:GetFirstSystem())return finale.FCCell(K.FirstMeasure,K.TopStaff)end;local L=finale.FCMusicRegion()L:SetFullDocument()return finale.FCCell(L.EndMeasure,L.EndStaff)end;function t.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local M=finale.FCMusicRegion()M:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),M.StartStaff)end;return t.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function t.get_top_left_selected_or_visible_cell()local F=finenv.Region()if not F:IsEmpty()then return finale.FCCell(F.StartMeasure,F.StartStaff)end;return t.get_top_left_visible_cell()end;function t.is_default_measure_number_visible_on_cell(N,O,P,Q)local R=finale.FCCurrentStaffSpec()if not R:LoadForCell(O,0)then return false end;if N:GetShowOnTopStaff()and O.Staff==P.TopStaff then return true end;if N:GetShowOnBottomStaff()and O.Staff==P:CalcBottomStaff()then return true end;if R.ShowMeasureNumbers then return not N:GetExcludeOtherStaves(Q)end;return false end;function t.is_default_number_visible_and_left_aligned(N,O,S,Q,T)if N.UseScoreInfoForParts then Q=false end;if T and N:GetShowOnMultiMeasureRests(Q)then if finale.MNALIGN_LEFT~=N:GetMultiMeasureAlignment(Q)then return false end elseif O.Measure==S.FirstMeasure then if not N:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=N:GetStartAlignment(Q)then return false end else if not N:GetShowMultiples(Q)then return false end;if finale.MNALIGN_LEFT~=N:GetMultipleAlignment(Q)then return false end end;return t.is_default_measure_number_visible_on_cell(N,O,S,Q)end;function t.update_layout(U,V)U=U or 1;V=V or false;local W=finale.FCPage()if W:Load(U)then W:UpdateLayout(V)end end;function t.get_current_part()local X=finale.FCParts()X:LoadAll()return X:GetCurrent()end;function t.get_page_format_prefs()local Y=t.get_current_part()local Z=finale.FCPageFormatPrefs()local _=false;if Y:IsScore()then _=Z:LoadScore()else _=Z:LoadParts()end;return Z,_ end;local a0=function(a1)local a2=finenv.UI():IsOnWindows()local a3=function(a4,a5)if finenv.UI():IsOnWindows()then return a4 and os.getenv(a4)or""else return a5 and os.getenv(a5)or""end end;local a6=a1 and a3("LOCALAPPDATA","HOME")or a3("COMMONPROGRAMFILES")if not a2 then a6=a6 .."/Library/Application Support"end;a6=a6 .."/SMuFL/Fonts/"return a6 end;function t.get_smufl_font_list()local a7={}local a8=function(a1)local a6=a0(a1)local a9=function()if finenv.UI():IsOnWindows()then return io.popen('dir "'..a6 ..'" /b /ad')else return io.popen('ls "'..a6 ..'"')end end;local aa=function(ab)local ac=finale.FCString()ac.LuaString=ab;return finenv.UI():IsFontAvailable(ac)end;for ab in a9():lines()do if not ab:find("%.")then ab=ab:gsub(" Bold","")ab=ab:gsub(" Italic","")local ac=finale.FCString()ac.LuaString=ab;if a7[ab]or aa(ab)then a7[ab]=a1 and"user"or"system"end end end end;a8(true)a8(false)return a7 end;function t.get_smufl_metadata_file(ad)if not ad then ad=finale.FCFontInfo()ad:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local ae=function(af,ad)local ag=af..ad.Name.."/"..ad.Name..".json"return io.open(ag,"r")end;local ah=ae(a0(true),ad)if ah then return ah end;return ae(a0(false),ad)end;function t.is_font_smufl_font(ad)if not ad then ad=finale.FCFontInfo()ad:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=t.finale_version(27,1)then if nil~=ad.IsSMuFLFont then return ad.IsSMuFLFont end end;local ai=t.get_smufl_metadata_file(ad)if nil~=ai then io.close(ai)return true end;return false end;function t.simple_input(aj,ak)local al=finale.FCString()al.LuaString=""local am=finale.FCString()local an=160;function format_ctrl(ao,ap,aq,ar)ao:SetHeight(ap)ao:SetWidth(aq)am.LuaString=ar;ao:SetText(am)end;title_width=string.len(aj)*6+54;if title_width>an then an=title_width end;text_width=string.len(ak)*6;if text_width>an then an=text_width end;am.LuaString=aj;local as=finale.FCCustomLuaWindow()as:SetTitle(am)local at=as:CreateStatic(0,0)format_ctrl(at,16,an,ak)local au=as:CreateEdit(0,20)format_ctrl(au,20,an,"")as:CreateOkButton()as:CreateCancelButton()function callback(ao)end;as:RegisterHandleCommand(callback)if as:ExecuteModal(nil)==finale.EXECMODAL_OK then al.LuaString=au:GetText(al)return al.LuaString end end;function t.is_finale_object(av)return av and type(av)=="userdata"and av.ClassName and av.GetClassID and true or false end;function t.system_indent_set_to_prefs(S,Z)Z=Z or t.get_page_format_prefs()local aw=finale.FCMeasure()local ax=S.FirstMeasure==1;if not ax and aw:Load(S.FirstMeasure)then if aw.ShowFullNames then ax=true end end;if ax and Z.UseFirstSystemMargins then S.LeftMargin=Z.FirstSystemLeft else S.LeftMargin=Z.SystemLeft end;return S:Save()end;function t.calc_script_name(ay)local az=finale.FCString()if finenv.RunningLuaFilePath then az.LuaString=finenv.RunningLuaFilePath()else az:SetRunningLuaFilePath()end;local aA=finale.FCString()az:SplitToPathAndFile(nil,aA)local x=aA.LuaString;if not ay then x=x:match("(.+)%..+")if not x or x==""then x=aA.LuaString end end;return x end;return t end)c("library.score",function(require,n,c,d)local t={}function t.finale_version(u,v,w)local x=bit32.bor(bit32.lshift(math.floor(u),24),bit32.lshift(math.floor(v),20))if w then x=bit32.bor(x,math.floor(w))end;return x end;function t.group_overlaps_region(y,z)if z:IsFullDocumentSpan()then return true end;local A=false;local B=finale.FCSystemStaves()B:LoadAllForRegion(z)for C in each(B)do if y:ContainsStaff(C:GetStaff())then A=true;break end end;if not A then return false end;if y.StartMeasure>z.EndMeasure or y.EndMeasure<z.StartMeasure then return false end;return true end;function t.group_is_contained_in_region(y,z)if not z:IsStaffIncluded(y.StartStaff)then return false end;if not z:IsStaffIncluded(y.EndStaff)then return false end;return true end;function t.staff_group_is_multistaff_instrument(y)local D=finale.FCMultiStaffInstruments()D:LoadAll()for E in each(D)do if E:ContainsStaff(y.StartStaff)and E.GroupID==y:GetItemID()then return true end end;return false end;function t.get_selected_region_or_whole_doc()local F=finenv.Region()if F:IsEmpty()then F:SetFullDocument()end;return F end;function t.get_first_cell_on_or_after_page(G)local H=G;local I=finale.FCPage()local J=false;while I:Load(H)do if I:GetFirstSystem()>0 then J=true;break end;H=H+1 end;if J then local K=finale.FCStaffSystem()K:Load(I:GetFirstSystem())return finale.FCCell(K.FirstMeasure,K.TopStaff)end;local L=finale.FCMusicRegion()L:SetFullDocument()return finale.FCCell(L.EndMeasure,L.EndStaff)end;function t.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local M=finale.FCMusicRegion()M:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),M.StartStaff)end;return t.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function t.get_top_left_selected_or_visible_cell()local F=finenv.Region()if not F:IsEmpty()then return finale.FCCell(F.StartMeasure,F.StartStaff)end;return t.get_top_left_visible_cell()end;function t.is_default_measure_number_visible_on_cell(N,O,P,Q)local R=finale.FCCurrentStaffSpec()if not R:LoadForCell(O,0)then return false end;if N:GetShowOnTopStaff()and O.Staff==P.TopStaff then return true end;if N:GetShowOnBottomStaff()and O.Staff==P:CalcBottomStaff()then return true end;if R.ShowMeasureNumbers then return not N:GetExcludeOtherStaves(Q)end;return false end;function t.is_default_number_visible_and_left_aligned(N,O,S,Q,T)if N.UseScoreInfoForParts then Q=false end;if T and N:GetShowOnMultiMeasureRests(Q)then if finale.MNALIGN_LEFT~=N:GetMultiMeasureAlignment(Q)then return false end elseif O.Measure==S.FirstMeasure then if not N:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=N:GetStartAlignment(Q)then return false end else if not N:GetShowMultiples(Q)then return false end;if finale.MNALIGN_LEFT~=N:GetMultipleAlignment(Q)then return false end end;return t.is_default_measure_number_visible_on_cell(N,O,S,Q)end;function t.update_layout(U,V)U=U or 1;V=V or false;local W=finale.FCPage()if W:Load(U)then W:UpdateLayout(V)end end;function t.get_current_part()local X=finale.FCParts()X:LoadAll()return X:GetCurrent()end;function t.get_page_format_prefs()local Y=t.get_current_part()local Z=finale.FCPageFormatPrefs()local _=false;if Y:IsScore()then _=Z:LoadScore()else _=Z:LoadParts()end;return Z,_ end;local a0=function(a1)local a2=finenv.UI():IsOnWindows()local a3=function(a4,a5)if finenv.UI():IsOnWindows()then return a4 and os.getenv(a4)or""else return a5 and os.getenv(a5)or""end end;local a6=a1 and a3("LOCALAPPDATA","HOME")or a3("COMMONPROGRAMFILES")if not a2 then a6=a6 .."/Library/Application Support"end;a6=a6 .."/SMuFL/Fonts/"return a6 end;function t.get_smufl_font_list()local a7={}local a8=function(a1)local a6=a0(a1)local a9=function()if finenv.UI():IsOnWindows()then return io.popen('dir "'..a6 ..'" /b /ad')else return io.popen('ls "'..a6 ..'"')end end;local aa=function(ab)local ac=finale.FCString()ac.LuaString=ab;return finenv.UI():IsFontAvailable(ac)end;for ab in a9():lines()do if not ab:find("%.")then ab=ab:gsub(" Bold","")ab=ab:gsub(" Italic","")local ac=finale.FCString()ac.LuaString=ab;if a7[ab]or aa(ab)then a7[ab]=a1 and"user"or"system"end end end end;a8(true)a8(false)return a7 end;function t.get_smufl_metadata_file(ad)if not ad then ad=finale.FCFontInfo()ad:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local ae=function(af,ad)local ag=af..ad.Name.."/"..ad.Name..".json"return io.open(ag,"r")end;local ah=ae(a0(true),ad)if ah then return ah end;return ae(a0(false),ad)end;function t.is_font_smufl_font(ad)if not ad then ad=finale.FCFontInfo()ad:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=t.finale_version(27,1)then if nil~=ad.IsSMuFLFont then return ad.IsSMuFLFont end end;local ai=t.get_smufl_metadata_file(ad)if nil~=ai then io.close(ai)return true end;return false end;function t.simple_input(aj,ak)local al=finale.FCString()al.LuaString=""local am=finale.FCString()local an=160;function format_ctrl(ao,ap,aq,ar)ao:SetHeight(ap)ao:SetWidth(aq)am.LuaString=ar;ao:SetText(am)end;title_width=string.len(aj)*6+54;if title_width>an then an=title_width end;text_width=string.len(ak)*6;if text_width>an then an=text_width end;am.LuaString=aj;local as=finale.FCCustomLuaWindow()as:SetTitle(am)local at=as:CreateStatic(0,0)format_ctrl(at,16,an,ak)local au=as:CreateEdit(0,20)format_ctrl(au,20,an,"")as:CreateOkButton()as:CreateCancelButton()function callback(ao)end;as:RegisterHandleCommand(callback)if as:ExecuteModal(nil)==finale.EXECMODAL_OK then al.LuaString=au:GetText(al)return al.LuaString end end;function t.is_finale_object(av)return av and type(av)=="userdata"and av.ClassName and av.GetClassID and true or false end;function t.system_indent_set_to_prefs(S,Z)Z=Z or t.get_page_format_prefs()local aw=finale.FCMeasure()local ax=S.FirstMeasure==1;if not ax and aw:Load(S.FirstMeasure)then if aw.ShowFullNames then ax=true end end;if ax and Z.UseFirstSystemMargins then S.LeftMargin=Z.FirstSystemLeft else S.LeftMargin=Z.SystemLeft end;return S:Save()end;function t.calc_script_name(ay)local az=finale.FCString()if finenv.RunningLuaFilePath then az.LuaString=finenv.RunningLuaFilePath()else az:SetRunningLuaFilePath()end;local aA=finale.FCString()az:SplitToPathAndFile(nil,aA)local x=aA.LuaString;if not ay then x=x:match("(.+)%..+")if not x or x==""then x=aA.LuaString end end;return x end;return t end)return a("__root")