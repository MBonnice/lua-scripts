local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.RequireSelection=true;finaleplugin.Author="Carl Vine"finaleplugin.AuthorURL="http://carlvine.com"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="v0.50"finaleplugin.Date="2022/05/17"finaleplugin.Notes=[[
        Swaps notes in the selected region between two layers chosen by the user.
    ]]return"Swap layers selective","Swap layers selective","Swap layers selectively"end;local o=require("library.layer")function find_errors(p,q)local r=""if p<1 or p>4 or q<1 or q>4 then r="Layer numbers must be\nintegers between 1 and 4"elseif p==q then r="Please nominate two DIFFERENT layers"end;if r~=""then finenv.UI():AlertNeutral("(script: "..plugindef()..")",r)return true end;return false end;function choose_layers_to_swap()local s=10;local t=25;local u=finenv.UI():IsOnMac()and 3 or 0;local v=110;local w={}local string=finale.FCString()local x=finale.FCCustomWindow()string.LuaString=plugindef()x:SetTitle(string)local y={{"swap layer# (1-4):",1},{"with layer# (1-4):",2}}for z,A in ipairs(y)do string.LuaString=A[1]local B=x:CreateStatic(0,s)B:SetText(string)B:SetWidth(200)w[z]=x:CreateEdit(v,s-u)w[z]:SetInteger(A[2])s=s+t end;x:CreateOkButton()x:CreateCancelButton()return x:ExecuteModal(nil),w[1]:GetInteger(),w[2]:GetInteger()end;function layers_swap_selective()local C,p,q=choose_layers_to_swap()if C==finale.EXECMODAL_OK and not find_errors(p,q)then o.swap(finenv.Region(),p,q)end end;layers_swap_selective()end)c("library.layer",function(require,n,c,d)local D={}function D.finale_version(E,F,G)local H=bit32.bor(bit32.lshift(math.floor(E),24),bit32.lshift(math.floor(F),20))if G then H=bit32.bor(H,math.floor(G))end;return H end;function D.group_overlaps_region(I,J)if J:IsFullDocumentSpan()then return true end;local K=false;local L=finale.FCSystemStaves()L:LoadAllForRegion(J)for M in each(L)do if I:ContainsStaff(M:GetStaff())then K=true;break end end;if not K then return false end;if I.StartMeasure>J.EndMeasure or I.EndMeasure<J.StartMeasure then return false end;return true end;function D.group_is_contained_in_region(I,J)if not J:IsStaffIncluded(I.StartStaff)then return false end;if not J:IsStaffIncluded(I.EndStaff)then return false end;return true end;function D.staff_group_is_multistaff_instrument(I)local N=finale.FCMultiStaffInstruments()N:LoadAll()for O in each(N)do if O:ContainsStaff(I.StartStaff)and O.GroupID==I:GetItemID()then return true end end;return false end;function D.get_selected_region_or_whole_doc()local P=finenv.Region()if P:IsEmpty()then P:SetFullDocument()end;return P end;function D.get_first_cell_on_or_after_page(Q)local R=Q;local S=finale.FCPage()local T=false;while S:Load(R)do if S:GetFirstSystem()>0 then T=true;break end;R=R+1 end;if T then local U=finale.FCStaffSystem()U:Load(S:GetFirstSystem())return finale.FCCell(U.FirstMeasure,U.TopStaff)end;local V=finale.FCMusicRegion()V:SetFullDocument()return finale.FCCell(V.EndMeasure,V.EndStaff)end;function D.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local W=finale.FCMusicRegion()W:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),W.StartStaff)end;return D.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function D.get_top_left_selected_or_visible_cell()local P=finenv.Region()if not P:IsEmpty()then return finale.FCCell(P.StartMeasure,P.StartStaff)end;return D.get_top_left_visible_cell()end;function D.is_default_measure_number_visible_on_cell(X,Y,Z,_)local a0=finale.FCCurrentStaffSpec()if not a0:LoadForCell(Y,0)then return false end;if X:GetShowOnTopStaff()and Y.Staff==Z.TopStaff then return true end;if X:GetShowOnBottomStaff()and Y.Staff==Z:CalcBottomStaff()then return true end;if a0.ShowMeasureNumbers then return not X:GetExcludeOtherStaves(_)end;return false end;function D.is_default_number_visible_and_left_aligned(X,Y,a1,_,a2)if X.UseScoreInfoForParts then _=false end;if a2 and X:GetShowOnMultiMeasureRests(_)then if finale.MNALIGN_LEFT~=X:GetMultiMeasureAlignment(_)then return false end elseif Y.Measure==a1.FirstMeasure then if not X:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=X:GetStartAlignment(_)then return false end else if not X:GetShowMultiples(_)then return false end;if finale.MNALIGN_LEFT~=X:GetMultipleAlignment(_)then return false end end;return D.is_default_measure_number_visible_on_cell(X,Y,a1,_)end;function D.update_layout(a3,a4)a3=a3 or 1;a4=a4 or false;local a5=finale.FCPage()if a5:Load(a3)then a5:UpdateLayout(a4)end end;function D.get_current_part()local a6=finale.FCParts()a6:LoadAll()return a6:GetCurrent()end;function D.get_page_format_prefs()local a7=D.get_current_part()local a8=finale.FCPageFormatPrefs()local a9=false;if a7:IsScore()then a9=a8:LoadScore()else a9=a8:LoadParts()end;return a8,a9 end;local aa=function(ab)local ac=finenv.UI():IsOnWindows()local ad=function(ae,af)if finenv.UI():IsOnWindows()then return ae and os.getenv(ae)or""else return af and os.getenv(af)or""end end;local ag=ab and ad("LOCALAPPDATA","HOME")or ad("COMMONPROGRAMFILES")if not ac then ag=ag.."/Library/Application Support"end;ag=ag.."/SMuFL/Fonts/"return ag end;function D.get_smufl_font_list()local ah={}local ai=function(ab)local ag=aa(ab)local aj=function()if finenv.UI():IsOnWindows()then return io.popen('dir "'..ag..'" /b /ad')else return io.popen('ls "'..ag..'"')end end;local ak=function(al)local am=finale.FCString()am.LuaString=al;return finenv.UI():IsFontAvailable(am)end;for al in aj():lines()do if not al:find("%.")then al=al:gsub(" Bold","")al=al:gsub(" Italic","")local am=finale.FCString()am.LuaString=al;if ah[al]or ak(al)then ah[al]=ab and"user"or"system"end end end end;ai(true)ai(false)return ah end;function D.get_smufl_metadata_file(an)if not an then an=finale.FCFontInfo()an:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local ao=function(ap,an)local aq=ap..an.Name.."/"..an.Name..".json"return io.open(aq,"r")end;local ar=ao(aa(true),an)if ar then return ar end;return ao(aa(false),an)end;function D.is_font_smufl_font(an)if not an then an=finale.FCFontInfo()an:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=D.finale_version(27,1)then if nil~=an.IsSMuFLFont then return an.IsSMuFLFont end end;local as=D.get_smufl_metadata_file(an)if nil~=as then io.close(as)return true end;return false end;function D.simple_input(at,au)local av=finale.FCString()av.LuaString=""local aw=finale.FCString()local ax=160;function format_ctrl(ay,az,aA,aB)ay:SetHeight(az)ay:SetWidth(aA)aw.LuaString=aB;ay:SetText(aw)end;title_width=string.len(at)*6+54;if title_width>ax then ax=title_width end;text_width=string.len(au)*6;if text_width>ax then ax=text_width end;aw.LuaString=at;local x=finale.FCCustomLuaWindow()x:SetTitle(aw)local aC=x:CreateStatic(0,0)format_ctrl(aC,16,ax,au)local aD=x:CreateEdit(0,20)format_ctrl(aD,20,ax,"")x:CreateOkButton()x:CreateCancelButton()function callback(ay)end;x:RegisterHandleCommand(callback)if x:ExecuteModal(nil)==finale.EXECMODAL_OK then av.LuaString=aD:GetText(av)return av.LuaString end end;function D.is_finale_object(aE)return aE and type(aE)=="userdata"and aE.ClassName and aE.GetClassID and true or false end;function D.system_indent_set_to_prefs(a1,a8)a8=a8 or D.get_page_format_prefs()local aF=finale.FCMeasure()local aG=a1.FirstMeasure==1;if not aG and aF:Load(a1.FirstMeasure)then if aF.ShowFullNames then aG=true end end;if aG and a8.UseFirstSystemMargins then a1.LeftMargin=a8.FirstSystemLeft else a1.LeftMargin=a8.SystemLeft end;return a1:Save()end;function D.calc_script_name(aH)local aI=finale.FCString()if finenv.RunningLuaFilePath then aI.LuaString=finenv.RunningLuaFilePath()else aI:SetRunningLuaFilePath()end;local aJ=finale.FCString()aI:SplitToPathAndFile(nil,aJ)local H=aJ.LuaString;if not aH then H=H:match("(.+)%..+")if not H or H==""then H=aJ.LuaString end end;return H end;return D end)return a("__root")