local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.RequireSelection=true;finaleplugin.Author="Robert Patterson"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.1"finaleplugin.Date="March 20, 2021"finaleplugin.CategoryTags="Expression"return"Expression Remove Enclosure","Expression Remove Enclosure","Removes any enclosure on any single-staff text expression in the currently selected region."end;local o=require("library.general_library")local p=require("library.expression")function expression_remove_enclosure()local q=o.get_current_part()local r=finale.FCExpressions()r:LoadAllForRegion(finenv.Region())for s in each(r)do if not s:IsShape()and s:IsSingleStaffAssigned()then if p.is_for_current_part(s,q)then local t=finale.FCTextExpressionDef()if t:Load(s.ID)then if t.UseEnclosure then local u=t:CreateEnclosure()if nil~=u then u:DeleteData()end;t:SetUseEnclosure(false)t:Save()end end end end end end;expression_remove_enclosure()end)c("library.expression",function(require,n,c,d)local o={}function o.finale_version(v,w,x)local y=bit32.bor(bit32.lshift(math.floor(v),24),bit32.lshift(math.floor(w),20))if x then y=bit32.bor(y,math.floor(x))end;return y end;function o.group_overlaps_region(z,A)if A:IsFullDocumentSpan()then return true end;local B=false;local C=finale.FCSystemStaves()C:LoadAllForRegion(A)for D in each(C)do if z:ContainsStaff(D:GetStaff())then B=true;break end end;if not B then return false end;if z.StartMeasure>A.EndMeasure or z.EndMeasure<A.StartMeasure then return false end;return true end;function o.group_is_contained_in_region(z,A)if not A:IsStaffIncluded(z.StartStaff)then return false end;if not A:IsStaffIncluded(z.EndStaff)then return false end;return true end;function o.staff_group_is_multistaff_instrument(z)local E=finale.FCMultiStaffInstruments()E:LoadAll()for F in each(E)do if F:ContainsStaff(z.StartStaff)and F.GroupID==z:GetItemID()then return true end end;return false end;function o.get_selected_region_or_whole_doc()local G=finenv.Region()if G:IsEmpty()then G:SetFullDocument()end;return G end;function o.get_first_cell_on_or_after_page(H)local I=H;local J=finale.FCPage()local K=false;while J:Load(I)do if J:GetFirstSystem()>0 then K=true;break end;I=I+1 end;if K then local L=finale.FCStaffSystem()L:Load(J:GetFirstSystem())return finale.FCCell(L.FirstMeasure,L.TopStaff)end;local M=finale.FCMusicRegion()M:SetFullDocument()return finale.FCCell(M.EndMeasure,M.EndStaff)end;function o.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local N=finale.FCMusicRegion()N:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),N.StartStaff)end;return o.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function o.get_top_left_selected_or_visible_cell()local G=finenv.Region()if not G:IsEmpty()then return finale.FCCell(G.StartMeasure,G.StartStaff)end;return o.get_top_left_visible_cell()end;function o.is_default_measure_number_visible_on_cell(O,P,Q,R)local S=finale.FCCurrentStaffSpec()if not S:LoadForCell(P,0)then return false end;if O:GetShowOnTopStaff()and P.Staff==Q.TopStaff then return true end;if O:GetShowOnBottomStaff()and P.Staff==Q:CalcBottomStaff()then return true end;if S.ShowMeasureNumbers then return not O:GetExcludeOtherStaves(R)end;return false end;function o.is_default_number_visible_and_left_aligned(O,P,T,R,U)if O.UseScoreInfoForParts then R=false end;if U and O:GetShowOnMultiMeasureRests(R)then if finale.MNALIGN_LEFT~=O:GetMultiMeasureAlignment(R)then return false end elseif P.Measure==T.FirstMeasure then if not O:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=O:GetStartAlignment(R)then return false end else if not O:GetShowMultiples(R)then return false end;if finale.MNALIGN_LEFT~=O:GetMultipleAlignment(R)then return false end end;return o.is_default_measure_number_visible_on_cell(O,P,T,R)end;function o.update_layout(V,W)V=V or 1;W=W or false;local X=finale.FCPage()if X:Load(V)then X:UpdateLayout(W)end end;function o.get_current_part()local Y=finale.FCParts()Y:LoadAll()return Y:GetCurrent()end;function o.get_page_format_prefs()local q=o.get_current_part()local Z=finale.FCPageFormatPrefs()local _=false;if q:IsScore()then _=Z:LoadScore()else _=Z:LoadParts()end;return Z,_ end;function o.get_smufl_metadata_file(a0)if not a0 then a0=finale.FCFontInfo()a0:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local a1=function(a2,a0)local a3=a2 .."/SMuFL/Fonts/"..a0.Name.."/"..a0.Name..".json"return io.open(a3,"r")end;local a4=""if finenv.UI():IsOnWindows()then a4=os.getenv("LOCALAPPDATA")else a4=os.getenv("HOME").."/Library/Application Support"end;local a5=a1(a4,a0)if nil~=a5 then return a5 end;local a6="/Library/Application Support"if finenv.UI():IsOnWindows()then a6=os.getenv("COMMONPROGRAMFILES")end;return a1(a6,a0)end;function o.is_font_smufl_font(a0)if not a0 then a0=finale.FCFontInfo()a0:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=o.finale_version(27,1)then if nil~=a0.IsSMuFLFont then return a0.IsSMuFLFont end end;local a7=o.get_smufl_metadata_file(a0)if nil~=a7 then io.close(a7)return true end;return false end;function o.simple_input(a8,a9)local aa=finale.FCString()aa.LuaString=""local ab=finale.FCString()local ac=160;function format_ctrl(ad,ae,af,ag)ad:SetHeight(ae)ad:SetWidth(af)ab.LuaString=ag;ad:SetText(ab)end;title_width=string.len(a8)*6+54;if title_width>ac then ac=title_width end;text_width=string.len(a9)*6;if text_width>ac then ac=text_width end;ab.LuaString=a8;local ah=finale.FCCustomLuaWindow()ah:SetTitle(ab)local ai=ah:CreateStatic(0,0)format_ctrl(ai,16,ac,a9)local aj=ah:CreateEdit(0,20)format_ctrl(aj,20,ac,"")ah:CreateOkButton()ah:CreateCancelButton()function callback(ad)end;ah:RegisterHandleCommand(callback)if ah:ExecuteModal(nil)==finale.EXECMODAL_OK then aa.LuaString=aj:GetText(aa)return aa.LuaString end end;function o.is_finale_object(ak)return ak and type(ak)=="userdata"and ak.ClassName and ak.GetClassID and true or false end;function o.system_indent_set_to_prefs(T,Z)Z=Z or o.get_page_format_prefs()local al=finale.FCMeasure()local am=T.FirstMeasure==1;if not am and al:Load(T.FirstMeasure)then if al.ShowFullNames then am=true end end;if am and Z.UseFirstSystemMargins then T.LeftMargin=Z.FirstSystemLeft else T.LeftMargin=Z.SystemLeft end;return T:Save()end;return o end)c("library.general_library",function(require,n,c,d)local o={}function o.finale_version(v,w,x)local y=bit32.bor(bit32.lshift(math.floor(v),24),bit32.lshift(math.floor(w),20))if x then y=bit32.bor(y,math.floor(x))end;return y end;function o.group_overlaps_region(z,A)if A:IsFullDocumentSpan()then return true end;local B=false;local C=finale.FCSystemStaves()C:LoadAllForRegion(A)for D in each(C)do if z:ContainsStaff(D:GetStaff())then B=true;break end end;if not B then return false end;if z.StartMeasure>A.EndMeasure or z.EndMeasure<A.StartMeasure then return false end;return true end;function o.group_is_contained_in_region(z,A)if not A:IsStaffIncluded(z.StartStaff)then return false end;if not A:IsStaffIncluded(z.EndStaff)then return false end;return true end;function o.staff_group_is_multistaff_instrument(z)local E=finale.FCMultiStaffInstruments()E:LoadAll()for F in each(E)do if F:ContainsStaff(z.StartStaff)and F.GroupID==z:GetItemID()then return true end end;return false end;function o.get_selected_region_or_whole_doc()local G=finenv.Region()if G:IsEmpty()then G:SetFullDocument()end;return G end;function o.get_first_cell_on_or_after_page(H)local I=H;local J=finale.FCPage()local K=false;while J:Load(I)do if J:GetFirstSystem()>0 then K=true;break end;I=I+1 end;if K then local L=finale.FCStaffSystem()L:Load(J:GetFirstSystem())return finale.FCCell(L.FirstMeasure,L.TopStaff)end;local M=finale.FCMusicRegion()M:SetFullDocument()return finale.FCCell(M.EndMeasure,M.EndStaff)end;function o.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local N=finale.FCMusicRegion()N:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),N.StartStaff)end;return o.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function o.get_top_left_selected_or_visible_cell()local G=finenv.Region()if not G:IsEmpty()then return finale.FCCell(G.StartMeasure,G.StartStaff)end;return o.get_top_left_visible_cell()end;function o.is_default_measure_number_visible_on_cell(O,P,Q,R)local S=finale.FCCurrentStaffSpec()if not S:LoadForCell(P,0)then return false end;if O:GetShowOnTopStaff()and P.Staff==Q.TopStaff then return true end;if O:GetShowOnBottomStaff()and P.Staff==Q:CalcBottomStaff()then return true end;if S.ShowMeasureNumbers then return not O:GetExcludeOtherStaves(R)end;return false end;function o.is_default_number_visible_and_left_aligned(O,P,T,R,U)if O.UseScoreInfoForParts then R=false end;if U and O:GetShowOnMultiMeasureRests(R)then if finale.MNALIGN_LEFT~=O:GetMultiMeasureAlignment(R)then return false end elseif P.Measure==T.FirstMeasure then if not O:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=O:GetStartAlignment(R)then return false end else if not O:GetShowMultiples(R)then return false end;if finale.MNALIGN_LEFT~=O:GetMultipleAlignment(R)then return false end end;return o.is_default_measure_number_visible_on_cell(O,P,T,R)end;function o.update_layout(V,W)V=V or 1;W=W or false;local X=finale.FCPage()if X:Load(V)then X:UpdateLayout(W)end end;function o.get_current_part()local Y=finale.FCParts()Y:LoadAll()return Y:GetCurrent()end;function o.get_page_format_prefs()local q=o.get_current_part()local Z=finale.FCPageFormatPrefs()local _=false;if q:IsScore()then _=Z:LoadScore()else _=Z:LoadParts()end;return Z,_ end;function o.get_smufl_metadata_file(a0)if not a0 then a0=finale.FCFontInfo()a0:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local a1=function(a2,a0)local a3=a2 .."/SMuFL/Fonts/"..a0.Name.."/"..a0.Name..".json"return io.open(a3,"r")end;local a4=""if finenv.UI():IsOnWindows()then a4=os.getenv("LOCALAPPDATA")else a4=os.getenv("HOME").."/Library/Application Support"end;local a5=a1(a4,a0)if nil~=a5 then return a5 end;local a6="/Library/Application Support"if finenv.UI():IsOnWindows()then a6=os.getenv("COMMONPROGRAMFILES")end;return a1(a6,a0)end;function o.is_font_smufl_font(a0)if not a0 then a0=finale.FCFontInfo()a0:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=o.finale_version(27,1)then if nil~=a0.IsSMuFLFont then return a0.IsSMuFLFont end end;local a7=o.get_smufl_metadata_file(a0)if nil~=a7 then io.close(a7)return true end;return false end;function o.simple_input(a8,a9)local aa=finale.FCString()aa.LuaString=""local ab=finale.FCString()local ac=160;function format_ctrl(ad,ae,af,ag)ad:SetHeight(ae)ad:SetWidth(af)ab.LuaString=ag;ad:SetText(ab)end;title_width=string.len(a8)*6+54;if title_width>ac then ac=title_width end;text_width=string.len(a9)*6;if text_width>ac then ac=text_width end;ab.LuaString=a8;local ah=finale.FCCustomLuaWindow()ah:SetTitle(ab)local ai=ah:CreateStatic(0,0)format_ctrl(ai,16,ac,a9)local aj=ah:CreateEdit(0,20)format_ctrl(aj,20,ac,"")ah:CreateOkButton()ah:CreateCancelButton()function callback(ad)end;ah:RegisterHandleCommand(callback)if ah:ExecuteModal(nil)==finale.EXECMODAL_OK then aa.LuaString=aj:GetText(aa)return aa.LuaString end end;function o.is_finale_object(ak)return ak and type(ak)=="userdata"and ak.ClassName and ak.GetClassID and true or false end;function o.system_indent_set_to_prefs(T,Z)Z=Z or o.get_page_format_prefs()local al=finale.FCMeasure()local am=T.FirstMeasure==1;if not am and al:Load(T.FirstMeasure)then if al.ShowFullNames then am=true end end;if am and Z.UseFirstSystemMargins then T.LeftMargin=Z.FirstSystemLeft else T.LeftMargin=Z.SystemLeft end;return T:Save()end;return o end)return a("__root")