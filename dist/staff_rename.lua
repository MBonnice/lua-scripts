function plugindef()finaleplugin.Author="Jacob Winkler"finaleplugin.Copyright="2022"finaleplugin.Version="1.1"finaleplugin.Date="3/18/2022"finaleplugin.Notes=[[
USING THE 'STAFF RENAME' SCRIPT

This script creates a dialog containing the full and abbreviated names of all selected instruments, including multi-staff instruments such as organ or piano. This allows for quick renaming of staves, with far less mouse clicking than trying to rename them from the Score Manager.

If there is no selection, all staves will be loaded.

There are buttons for each instrument that will copy the full name into the abbreviated name field.

There is a popup at the bottom of the list that will automatically set all transposing instruments to show either the instrument and then the transposition (e.g. "Clarinet in Bb"), or the transposition and then the instrument (e.g. "Bb Clarinet").

Speaking of the Bb Clarinet... Accidentals are displayed with square brackets, so the dialog will show "B[b] Clarinet". This is then converted into symbols using the appropriate Enigma tags. All other font info is retained.

Note that this script is not currently able to address Finale's auto-numbering. When this feature is added to future versions of RGP Lua I will update the script to allow for some quick processing of these as well, such as being able to switch numbering systems for all instruments at once, or hard-coding the player number into the full/abbreviated names and removing auto-numbering.
]]return"Rename Staves","Rename Staves","Renames selected staves"end;function staff_rename()local a=finale.FCMultiStaffInstruments()a:LoadAll()local b={}local c={}local d={}local e={}local f={}local g={}local h={}local i={}local j={}local k={}local l={}local m={}local n={}local o={}local p={}local q={}local r={}local s={}local t={"Clarinet in B[b]","Clarinet in A","Clarinet in E[b]","Horn in F","Trumpet in B[b]","Trumpet in C","Horn in E[b]","Piccolo Trumpet in A","Trumpet in D","Cornet in E[b]","Pennywhistle in D","Pennywhistle in G","Tin Whistle in B[b]","Melody Sax in C"}local u={"B[b] Clarinet","A Clarinet","E[b] Clarinet","F Horn","B[b] Trumpet","C Trumpet","E[b] Horn","A Piccolo Trumpet","D Trumpet","E[b] Cornet","D Pennywhistle","G Pennywhistle","B[b] Tin Whistle","C Melody Sax"}function enigma_to_accidental(v)v.LuaString=string.gsub(v.LuaString,"%^flat%(%)","[b]")v.LuaString=string.gsub(v.LuaString,"%^natural%(%)","[n]")v.LuaString=string.gsub(v.LuaString,"%^sharp%(%)","[#]")v:TrimEnigmaTags()return v end;function accidental_to_enigma(w)w.LuaString=string.gsub(w.LuaString,"%[b%]","^flat()")w.LuaString=string.gsub(w.LuaString,"%[n%]","^natural()")w.LuaString=string.gsub(w.LuaString,"%[%#%]","^sharp()")return w end;for x in each(a)do table.insert(b,x.GroupID)local y=finale.FCGroup()y:Load(0,x.GroupID)local v=y:CreateFullNameString()local z=v:CreateLastFontInfo()enigma_to_accidental(v)table.insert(c,v.LuaString)local A=finale.FCString()A=z:CreateEnigmaString(nil)table.insert(d,A.LuaString)v=y:CreateAbbreviatedNameString()z=v:CreateLastFontInfo()A=z:CreateEnigmaString(nil)enigma_to_accidental(v)table.insert(e,v.LuaString)table.insert(f,A.LuaString)table.insert(g,false)table.insert(h,x:GetFirstStaff())table.insert(h,x:GetSecondStaff())if x:GetThirdStaff()~=0 then table.insert(h,x:GetThirdStaff())end;table.insert(i,x:GetFirstStaff())table.insert(i,x:GetSecondStaff())table.insert(i,x:GetThirdStaff())table.insert(j,i)i={}end;local B=finale.FCSystemStaves()local C=finale.FCMusicRegion()C=finenv.Region()if C:IsEmpty()then C:SetFullDocument()end;B:LoadAllForRegion(C)for D in each(B)do for E,F in pairs(j)do for G,H in pairs(j[E])do if j[E][G]==D.Staff and j[E][G]~=0 then if g[E]==false then table.insert(k,c[E])table.insert(l,e[E])table.insert(m,d[E])table.insert(n,f[E])table.insert(o,D.Staff)g[E]=true;goto I elseif g==true then goto I end end end end;for E,F in pairs(h)do if h[E]==D.Staff then goto I end end;local J=finale.FCStaff()J:Load(D.Staff)local v=J:CreateFullNameString()local z=v:CreateLastFontInfo()enigma_to_accidental(v)table.insert(k,v.LuaString)local A=finale.FCString()A=z:CreateEnigmaString(nil)table.insert(m,A.LuaString)v=J:CreateAbbreviatedNameString()z=v:CreateLastFontInfo()enigma_to_accidental(v)table.insert(l,v.LuaString)A=z:CreateEnigmaString(nil)table.insert(n,A.LuaString)table.insert(o,D.Staff)::I::end;function dialog(K)local L=20;local M=1;local N=140;local O=20;local v=finale.FCString()v.LuaString=K;local dialog=finale.FCCustomLuaWindow()dialog:SetTitle(v)local P={}for E=1,100 do P[E]=(E-1)*L end;local Q={}for E=1,11 do Q[E]=(E-1)*N;Q[E]=Q[E]+40 end;function add_ctrl(dialog,R,S,T,U,V,W,X,Y)v.LuaString=S;local Z;if R=="button"then Z=dialog:CreateButton(T,U)elseif R=="popup"then Z=dialog:CreatePopup(T,U)elseif R=="checkbox"then Z=dialog:CreateCheckbox(T,U)elseif R=="edit"then Z=dialog:CreateEdit(T,U-2)elseif R=="horizontalline"then Z=dialog:CreateHorizontalLine(T,U,W)elseif R=="static"then Z=dialog:CreateStatic(T,U)elseif R=="verticalline"then Z=dialog:CreateVerticalLine(T,U,V)end;if R=="edit"then Z:SetHeight(V-2)Z:SetWidth(W-O)elseif R=="horizontalline"then Z:SetY(U+V/2)Z:SetWidth(W)else Z:SetHeight(V)Z:SetWidth(W)end;Z:SetText(v)return Z end;local _=add_ctrl(dialog,"static","Staff",0,P[1],L,N,0,0)local a0=add_ctrl(dialog,"static","Full Name",Q[1],P[1],L,N,0,0)local a1=add_ctrl(dialog,"static","Abbr. Name",Q[2],P[1],L,N,0,0)local a2=add_ctrl(dialog,"button","→",Q[2]-O+2,P[1],L-4,16,0,0)for E,F in pairs(o)do p[E]=add_ctrl(dialog,"static",o[E],10,P[E+1],L,N,0,0)q[E]=add_ctrl(dialog,"edit",k[E],Q[1],P[E+1],L,N,0,0)r[E]=add_ctrl(dialog,"edit",l[E],Q[2],P[E+1],L,N,0,0)s[E]=add_ctrl(dialog,"button","→",Q[2]-O+2,P[E+1],L-4,16,0,0)M=M+1 end;local a3=add_ctrl(dialog,"popup","",Q[1],P[M+1]+L/2,L,N-O,0,0)local a4={"Inst. in Tr.","Tr. Inst."}for E,F in pairs(a4)do v.LuaString=a4[E]a3:AddString(v)end;dialog:CreateOkButton()dialog:CreateCancelButton()function callback(Z)if Z:GetControlID()==a3:GetControlID()then local a5=a3:GetSelectedItem()local a6={}local a7={}if a5==0 then a6=u;a7=t elseif a5==1 then a6=t;a7=u end;for a8,a9 in pairs(a6)do a6[a8]=string.gsub(a6[a8],"%[","%%[")a6[a8]=string.gsub(a6[a8],"%]","%%]")a7[a8]=string.gsub(a7[a8],"%%","")end;for E,F in pairs(k)do q[E]:GetText(v)for G,H in pairs(a6)do v.LuaString=string.gsub(v.LuaString,a6[G],a7[G])end;q[E]:SetText(v)r[E]:GetText(v)for G,H in pairs(a6)do v.LuaString=string.gsub(v.LuaString,a6[G],a7[G])end;r[E]:SetText(v)end end;for E,F in pairs(s)do if Z:GetControlID()==s[E]:GetControlID()then q[E]:GetText(v)r[E]:SetText(v)end end;if Z:GetControlID()==a2:GetControlID()then for E,F in pairs(q)do q[E]:GetText(v)r[E]:SetText(v)end end end;dialog:RegisterHandleCommand(callback)if dialog:ExecuteModal(nil)==finale.EXECMODAL_OK then local v=finale.FCString()for E,F in pairs(o)do for G,H in pairs(j)do for aa,ab in pairs(j[G])do if o[E]==j[G][aa]then local y=finale.FCGroup()y:Load(0,b[G])q[E]:GetText(v)accidental_to_enigma(v)v.LuaString=m[E]..v.LuaString;y:SaveNewFullNameBlock(v)r[E]:GetText(v)accidental_to_enigma(v)v.LuaString=n[E]..v.LuaString;y:SaveNewAbbreviatedNameBlock(v)y:Save()end end end;for G,H in pairs(h)do if o[E]==h[G]then goto ac end end;local J=finale.FCStaff()J:Load(o[E])q[E]:GetText(v)accidental_to_enigma(v)v.LuaString=m[E]..v.LuaString;J:SaveNewFullNameString(v)r[E]:GetText(v)accidental_to_enigma(v)v.LuaString=n[E]..v.LuaString;J:SaveNewAbbreviatedNameString(v)J:Save()::ac::end end end;dialog("Rename Staves")end;staff_rename()