local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.Author="Nick Mazuk"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.0.0"finaleplugin.Date="March 26, 2022"finaleplugin.CategoryTags="Playback"finaleplugin.AuthorURL="https://nickmazuk.com"finaleplugin.Notes=[[
        Swaps layers 1 and 2 for the selected region.
    ]]return"Swap layers 1 and 2","Swap layers 1 and 2","Swaps layers 1 and 2"end;local o=require("library.layer")function layers_swap_1_2()o.swap(finenv.Region(),1,2)end;layers_swap_1_2()end)c("library.layer",function(require,n,c,d)local p={}function p.finale_version(q,r,s)local t=bit32.bor(bit32.lshift(math.floor(q),24),bit32.lshift(math.floor(r),20))if s then t=bit32.bor(t,math.floor(s))end;return t end;function p.group_overlaps_region(u,v)if v:IsFullDocumentSpan()then return true end;local w=false;local x=finale.FCSystemStaves()x:LoadAllForRegion(v)for y in each(x)do if u:ContainsStaff(y:GetStaff())then w=true;break end end;if not w then return false end;if u.StartMeasure>v.EndMeasure or u.EndMeasure<v.StartMeasure then return false end;return true end;function p.group_is_contained_in_region(u,v)if not v:IsStaffIncluded(u.StartStaff)then return false end;if not v:IsStaffIncluded(u.EndStaff)then return false end;return true end;function p.staff_group_is_multistaff_instrument(u)local z=finale.FCMultiStaffInstruments()z:LoadAll()for A in each(z)do if A:ContainsStaff(u.StartStaff)and A.GroupID==u:GetItemID()then return true end end;return false end;function p.get_selected_region_or_whole_doc()local B=finenv.Region()if B:IsEmpty()then B:SetFullDocument()end;return B end;function p.get_first_cell_on_or_after_page(C)local D=C;local E=finale.FCPage()local F=false;while E:Load(D)do if E:GetFirstSystem()>0 then F=true;break end;D=D+1 end;if F then local G=finale.FCStaffSystem()G:Load(E:GetFirstSystem())return finale.FCCell(G.FirstMeasure,G.TopStaff)end;local H=finale.FCMusicRegion()H:SetFullDocument()return finale.FCCell(H.EndMeasure,H.EndStaff)end;function p.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local I=finale.FCMusicRegion()I:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),I.StartStaff)end;return p.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function p.get_top_left_selected_or_visible_cell()local B=finenv.Region()if not B:IsEmpty()then return finale.FCCell(B.StartMeasure,B.StartStaff)end;return p.get_top_left_visible_cell()end;function p.is_default_measure_number_visible_on_cell(J,K,L,M)local N=finale.FCCurrentStaffSpec()if not N:LoadForCell(K,0)then return false end;if J:GetShowOnTopStaff()and K.Staff==L.TopStaff then return true end;if J:GetShowOnBottomStaff()and K.Staff==L:CalcBottomStaff()then return true end;if N.ShowMeasureNumbers then return not J:GetExcludeOtherStaves(M)end;return false end;function p.is_default_number_visible_and_left_aligned(J,K,O,M,P)if J.UseScoreInfoForParts then M=false end;if P and J:GetShowOnMultiMeasureRests(M)then if finale.MNALIGN_LEFT~=J:GetMultiMeasureAlignment(M)then return false end elseif K.Measure==O.FirstMeasure then if not J:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=J:GetStartAlignment(M)then return false end else if not J:GetShowMultiples(M)then return false end;if finale.MNALIGN_LEFT~=J:GetMultipleAlignment(M)then return false end end;return p.is_default_measure_number_visible_on_cell(J,K,O,M)end;function p.update_layout(Q,R)Q=Q or 1;R=R or false;local S=finale.FCPage()if S:Load(Q)then S:UpdateLayout(R)end end;function p.get_current_part()local T=finale.FCParts()T:LoadAll()return T:GetCurrent()end;function p.get_page_format_prefs()local U=p.get_current_part()local V=finale.FCPageFormatPrefs()local W=false;if U:IsScore()then W=V:LoadScore()else W=V:LoadParts()end;return V,W end;local X=function(Y)local Z=finenv.UI():IsOnWindows()local _=function(a0,a1)if finenv.UI():IsOnWindows()then return a0 and os.getenv(a0)or""else return a1 and os.getenv(a1)or""end end;local a2=Y and _("LOCALAPPDATA","HOME")or _("COMMONPROGRAMFILES")if not Z then a2=a2 .."/Library/Application Support"end;a2=a2 .."/SMuFL/Fonts/"return a2 end;function p.get_smufl_font_list()local a3={}local a4=function(Y)local a2=X(Y)local a5=function()if finenv.UI():IsOnWindows()then return io.popen('dir "'..a2 ..'" /b /ad')else return io.popen('ls "'..a2 ..'"')end end;local a6=function(a7)local a8=finale.FCString()a8.LuaString=a7;return finenv.UI():IsFontAvailable(a8)end;for a7 in a5():lines()do if not a7:find("%.")then a7=a7:gsub(" Bold","")a7=a7:gsub(" Italic","")local a8=finale.FCString()a8.LuaString=a7;if a3[a7]or a6(a7)then a3[a7]=Y and"user"or"system"end end end end;a4(true)a4(false)return a3 end;function p.get_smufl_metadata_file(a9)if not a9 then a9=finale.FCFontInfo()a9:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local aa=function(ab,a9)local ac=ab..a9.Name.."/"..a9.Name..".json"return io.open(ac,"r")end;local ad=aa(X(true),a9)if ad then return ad end;return aa(X(false),a9)end;function p.is_font_smufl_font(a9)if not a9 then a9=finale.FCFontInfo()a9:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=p.finale_version(27,1)then if nil~=a9.IsSMuFLFont then return a9.IsSMuFLFont end end;local ae=p.get_smufl_metadata_file(a9)if nil~=ae then io.close(ae)return true end;return false end;function p.simple_input(af,ag)local ah=finale.FCString()ah.LuaString=""local ai=finale.FCString()local aj=160;function format_ctrl(ak,al,am,an)ak:SetHeight(al)ak:SetWidth(am)ai.LuaString=an;ak:SetText(ai)end;title_width=string.len(af)*6+54;if title_width>aj then aj=title_width end;text_width=string.len(ag)*6;if text_width>aj then aj=text_width end;ai.LuaString=af;local ao=finale.FCCustomLuaWindow()ao:SetTitle(ai)local ap=ao:CreateStatic(0,0)format_ctrl(ap,16,aj,ag)local aq=ao:CreateEdit(0,20)format_ctrl(aq,20,aj,"")ao:CreateOkButton()ao:CreateCancelButton()function callback(ak)end;ao:RegisterHandleCommand(callback)if ao:ExecuteModal(nil)==finale.EXECMODAL_OK then ah.LuaString=aq:GetText(ah)return ah.LuaString end end;function p.is_finale_object(ar)return ar and type(ar)=="userdata"and ar.ClassName and ar.GetClassID and true or false end;function p.system_indent_set_to_prefs(O,V)V=V or p.get_page_format_prefs()local as=finale.FCMeasure()local at=O.FirstMeasure==1;if not at and as:Load(O.FirstMeasure)then if as.ShowFullNames then at=true end end;if at and V.UseFirstSystemMargins then O.LeftMargin=V.FirstSystemLeft else O.LeftMargin=V.SystemLeft end;return O:Save()end;function p.calc_script_name(au)local av=finale.FCString()if finenv.RunningLuaFilePath then av.LuaString=finenv.RunningLuaFilePath()else av:SetRunningLuaFilePath()end;local aw=finale.FCString()av:SplitToPathAndFile(nil,aw)local t=aw.LuaString;if not au then t=t:match("(.+)%..+")if not t or t==""then t=aw.LuaString end end;return t end;return p end)return a("__root")