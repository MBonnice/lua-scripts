local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.RequireSelection=true;finaleplugin.Author="Robert Patterson"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.0"finaleplugin.Date="April 23, 2022"finaleplugin.CategoryTags="Measure"finaleplugin.AuthorURL="https://robertgpatterson.com"finaleplugin.Notes=[[
        This script replaces the JW New Piece plugin, which is no longer available on Macs running M1 code.
        It creates a movement break starting with the first selected measure.
    ]]return"Create Movement Break","Create Movement Break","Creates a movement break at the first selected measure."end;local o=require("library.general_library")function measure_create_movement_break()local p=finenv.Region().StartMeasure;if p>1 then local q=finale.FCMeasure()q:Load(p)q.BreakWordExtension=true;q.ShowFullNames=true;q.SystemBreak=true;if q.ShowKeySignature~=finale.SHOWSTATE_HIDE then q.ShowKeySignature=finale.SHOWSTATE_SHOW end;if q.ShowTimeSignature~=finale.SHOWSTATE_HIDE then q.ShowTimeSignature=finale.SHOWSTATE_SHOW end;q:Save()local r=finale.FCMeasure()r:Load(p-1)r.BreakMMRest=true;r.Barline=finale.BARLINE_FINAL;r.HideCautionary=true;r:Save()local s=finale.FCMeasureNumberRegions()s:LoadAll()for t in each(s)do if t:IsMeasureIncluded(p)and t:IsMeasureIncluded(p-1)then local u=t.EndMeasure;t.EndMeasure=p-1;t:Save()t.StartMeasure=p;t.EndMeasure=u;t.StartNumber=1;t:SaveNew()end end end;local v=finale.FCParts()v:LoadAll()for w in each(v)do w:SwitchTo()local x=finale.FCMultiMeasureRests()x:LoadAll()for y in each(x)do if y:IsMeasureIncluded(p)and y:IsMeasureIncluded(p-1)then local u=y.EndMeasure;y.EndMeasure=p-1;y:Save()y.StartMeasure=p;y.EndMeasure=u;y:Save()end end;o.update_layout()local z=finale.FCStaffSystems()z:LoadAll()local A=z:FindMeasureNumber(p)o.system_indent_set_to_prefs(A)o.update_layout()w:SwitchBack()end end;measure_create_movement_break()end)c("library.general_library",function(require,n,c,d)local o={}function o.finale_version(B,C,D)local E=bit32.bor(bit32.lshift(math.floor(B),24),bit32.lshift(math.floor(C),20))if D then E=bit32.bor(E,math.floor(D))end;return E end;function o.group_overlaps_region(F,G)if G:IsFullDocumentSpan()then return true end;local H=false;local I=finale.FCSystemStaves()I:LoadAllForRegion(G)for J in each(I)do if F:ContainsStaff(J:GetStaff())then H=true;break end end;if not H then return false end;if F.StartMeasure>G.EndMeasure or F.EndMeasure<G.StartMeasure then return false end;return true end;function o.group_is_contained_in_region(F,G)if not G:IsStaffIncluded(F.StartStaff)then return false end;if not G:IsStaffIncluded(F.EndStaff)then return false end;return true end;function o.staff_group_is_multistaff_instrument(F)local K=finale.FCMultiStaffInstruments()K:LoadAll()for L in each(K)do if L:ContainsStaff(F.StartStaff)and L.GroupID==F:GetItemID()then return true end end;return false end;function o.get_selected_region_or_whole_doc()local M=finenv.Region()if M:IsEmpty()then M:SetFullDocument()end;return M end;function o.get_first_cell_on_or_after_page(N)local O=N;local P=finale.FCPage()local Q=false;while P:Load(O)do if P:GetFirstSystem()>0 then Q=true;break end;O=O+1 end;if Q then local R=finale.FCStaffSystem()R:Load(P:GetFirstSystem())return finale.FCCell(R.FirstMeasure,R.TopStaff)end;local S=finale.FCMusicRegion()S:SetFullDocument()return finale.FCCell(S.EndMeasure,S.EndStaff)end;function o.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local T=finale.FCMusicRegion()T:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),T.StartStaff)end;return o.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function o.get_top_left_selected_or_visible_cell()local M=finenv.Region()if not M:IsEmpty()then return finale.FCCell(M.StartMeasure,M.StartStaff)end;return o.get_top_left_visible_cell()end;function o.is_default_measure_number_visible_on_cell(t,U,V,W)local X=finale.FCCurrentStaffSpec()if not X:LoadForCell(U,0)then return false end;if t:GetShowOnTopStaff()and U.Staff==V.TopStaff then return true end;if t:GetShowOnBottomStaff()and U.Staff==V:CalcBottomStaff()then return true end;if X.ShowMeasureNumbers then return not t:GetExcludeOtherStaves(W)end;return false end;function o.is_default_number_visible_and_left_aligned(t,U,A,W,Y)if t.UseScoreInfoForParts then W=false end;if Y and t:GetShowOnMultiMeasureRests(W)then if finale.MNALIGN_LEFT~=t:GetMultiMeasureAlignment(W)then return false end elseif U.Measure==A.FirstMeasure then if not t:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=t:GetStartAlignment(W)then return false end else if not t:GetShowMultiples(W)then return false end;if finale.MNALIGN_LEFT~=t:GetMultipleAlignment(W)then return false end end;return o.is_default_measure_number_visible_on_cell(t,U,A,W)end;function o.update_layout(Z,_)Z=Z or 1;_=_ or false;local a0=finale.FCPage()if a0:Load(Z)then a0:UpdateLayout(_)end end;function o.get_current_part()local v=finale.FCParts()v:LoadAll()return v:GetCurrent()end;function o.get_page_format_prefs()local a1=o.get_current_part()local a2=finale.FCPageFormatPrefs()local a3=false;if a1:IsScore()then a3=a2:LoadScore()else a3=a2:LoadParts()end;return a2,a3 end;function o.get_smufl_metadata_file(a4)if not a4 then a4=finale.FCFontInfo()a4:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local a5=function(a6,a4)local a7=a6 .."/SMuFL/Fonts/"..a4.Name.."/"..a4.Name..".json"return io.open(a7,"r")end;local a8=""if finenv.UI():IsOnWindows()then a8=os.getenv("LOCALAPPDATA")else a8=os.getenv("HOME").."/Library/Application Support"end;local a9=a5(a8,a4)if nil~=a9 then return a9 end;local aa="/Library/Application Support"if finenv.UI():IsOnWindows()then aa=os.getenv("COMMONPROGRAMFILES")end;return a5(aa,a4)end;function o.is_font_smufl_font(a4)if not a4 then a4=finale.FCFontInfo()a4:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=o.finale_version(27,1)then if nil~=a4.IsSMuFLFont then return a4.IsSMuFLFont end end;local ab=o.get_smufl_metadata_file(a4)if nil~=ab then io.close(ab)return true end;return false end;function o.simple_input(ac,ad)local ae=finale.FCString()ae.LuaString=""local af=finale.FCString()local ag=160;function format_ctrl(ah,ai,aj,ak)ah:SetHeight(ai)ah:SetWidth(aj)af.LuaString=ak;ah:SetText(af)end;title_width=string.len(ac)*6+54;if title_width>ag then ag=title_width end;text_width=string.len(ad)*6;if text_width>ag then ag=text_width end;af.LuaString=ac;local al=finale.FCCustomLuaWindow()al:SetTitle(af)local am=al:CreateStatic(0,0)format_ctrl(am,16,ag,ad)local an=al:CreateEdit(0,20)format_ctrl(an,20,ag,"")al:CreateOkButton()al:CreateCancelButton()function callback(ah)end;al:RegisterHandleCommand(callback)if al:ExecuteModal(nil)==finale.EXECMODAL_OK then ae.LuaString=an:GetText(ae)return ae.LuaString end end;function o.is_finale_object(ao)return ao and type(ao)=="userdata"and ao.ClassName and ao.GetClassID and true or false end;function o.system_indent_set_to_prefs(A,a2)a2=a2 or o.get_page_format_prefs()local ap=finale.FCMeasure()local aq=A.FirstMeasure==1;if not aq and ap:Load(A.FirstMeasure)then if ap.ShowFullNames then aq=true end end;if aq and a2.UseFirstSystemMargins then A.LeftMargin=a2.FirstSystemLeft else A.LeftMargin=a2.SystemLeft end;return A:Save()end;return o end)return a("__root")