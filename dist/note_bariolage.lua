local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.Author="Jacob Winkler"finaleplugin.Copyright="2022"finaleplugin.Version="1.0"finaleplugin.Date="3/18/2022"finaleplugin.Notes=[[
        USING THE 'BARIOLAGE' SCRIPT

        This script creates bariolage-style notation where layers 1 and 2 interlock. It works well for material that has even-numbered beam groups like 4x 16th notes or 6x 16th notes (in compound meters). 32nd notes also work. Odd numbers of notes produce undesirable results.

        To use, create a suitable musical passage in layer 1, then run the script. The script does the following:
        - Duplicates layer 1 to layer 2.
        - Mutes playback of layer 2.
        - Iterates through the notes in layer 1. For even-numbered notes (i.e. the 2nd and 4th 16ths in a group of 4) it replaces the stem with a blank shape, effectively hiding it.
        - Any note in layer 1 that is the last note of a beamed group is hidden.
        - Iterates through the notes in layer 2 and changes the stems of the odd-numbered notes.
        - Any note in layer 2 that is the beginning of a beamed group is hidden.
    ]]return"Bariolage","Bariolage","Bariolage: Creates alternating layer pattern from layer 1. Doesn't play nicely with odd numbered groups!"end;local o=require("library.layer")local p=require("library.note_entry")function bariolage()local q=finenv.Region()o.copy(q,1,2)local r=1;local s=1;for t in eachentrysaved(finenv.Region())do if t:IsNote()then if t.LayerNumber==1 then if t:CalcBeamedGroupEnd()then t.Visible=false end;if r%2==0 then print()p.hide_stem(t)end;r=r+1 elseif t.LayerNumber==2 then if t:GetBeamBeat()then t.Visible=false end;if s%2==1 then print()p.hide_stem(t)end;t:SetPlayback(false)s=s+1 end end end end;bariolage()end)c("library.note_entry",function(require,n,c,d)local u={}function u.finale_version(v,w,x)local y=bit32.bor(bit32.lshift(math.floor(v),24),bit32.lshift(math.floor(w),20))if x then y=bit32.bor(y,math.floor(x))end;return y end;function u.group_overlaps_region(z,q)if q:IsFullDocumentSpan()then return true end;local A=false;local B=finale.FCSystemStaves()B:LoadAllForRegion(q)for C in each(B)do if z:ContainsStaff(C:GetStaff())then A=true;break end end;if not A then return false end;if z.StartMeasure>q.EndMeasure or z.EndMeasure<q.StartMeasure then return false end;return true end;function u.group_is_contained_in_region(z,q)if not q:IsStaffIncluded(z.StartStaff)then return false end;if not q:IsStaffIncluded(z.EndStaff)then return false end;return true end;function u.staff_group_is_multistaff_instrument(z)local D=finale.FCMultiStaffInstruments()D:LoadAll()for E in each(D)do if E:ContainsStaff(z.StartStaff)and E.GroupID==z:GetItemID()then return true end end;return false end;function u.get_selected_region_or_whole_doc()local F=finenv.Region()if F:IsEmpty()then F:SetFullDocument()end;return F end;function u.get_first_cell_on_or_after_page(G)local H=G;local I=finale.FCPage()local J=false;while I:Load(H)do if I:GetFirstSystem()>0 then J=true;break end;H=H+1 end;if J then local K=finale.FCStaffSystem()K:Load(I:GetFirstSystem())return finale.FCCell(K.FirstMeasure,K.TopStaff)end;local L=finale.FCMusicRegion()L:SetFullDocument()return finale.FCCell(L.EndMeasure,L.EndStaff)end;function u.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local M=finale.FCMusicRegion()M:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),M.StartStaff)end;return u.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function u.get_top_left_selected_or_visible_cell()local F=finenv.Region()if not F:IsEmpty()then return finale.FCCell(F.StartMeasure,F.StartStaff)end;return u.get_top_left_visible_cell()end;function u.is_default_measure_number_visible_on_cell(N,O,P,Q)local R=finale.FCCurrentStaffSpec()if not R:LoadForCell(O,0)then return false end;if N:GetShowOnTopStaff()and O.Staff==P.TopStaff then return true end;if N:GetShowOnBottomStaff()and O.Staff==P:CalcBottomStaff()then return true end;if R.ShowMeasureNumbers then return not N:GetExcludeOtherStaves(Q)end;return false end;function u.is_default_number_visible_and_left_aligned(N,O,S,Q,T)if N.UseScoreInfoForParts then Q=false end;if T and N:GetShowOnMultiMeasureRests(Q)then if finale.MNALIGN_LEFT~=N:GetMultiMeasureAlignment(Q)then return false end elseif O.Measure==S.FirstMeasure then if not N:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=N:GetStartAlignment(Q)then return false end else if not N:GetShowMultiples(Q)then return false end;if finale.MNALIGN_LEFT~=N:GetMultipleAlignment(Q)then return false end end;return u.is_default_measure_number_visible_on_cell(N,O,S,Q)end;function u.update_layout(U,V)U=U or 1;V=V or false;local W=finale.FCPage()if W:Load(U)then W:UpdateLayout(V)end end;function u.get_current_part()local X=finale.FCParts()X:LoadAll()return X:GetCurrent()end;function u.get_page_format_prefs()local Y=u.get_current_part()local Z=finale.FCPageFormatPrefs()local _=false;if Y:IsScore()then _=Z:LoadScore()else _=Z:LoadParts()end;return Z,_ end;function u.get_smufl_metadata_file(a0)if not a0 then a0=finale.FCFontInfo()a0:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local a1=function(a2,a0)local a3=a2 .."/SMuFL/Fonts/"..a0.Name.."/"..a0.Name..".json"return io.open(a3,"r")end;local a4=""if finenv.UI():IsOnWindows()then a4=os.getenv("LOCALAPPDATA")else a4=os.getenv("HOME").."/Library/Application Support"end;local a5=a1(a4,a0)if nil~=a5 then return a5 end;local a6="/Library/Application Support"if finenv.UI():IsOnWindows()then a6=os.getenv("COMMONPROGRAMFILES")end;return a1(a6,a0)end;function u.is_font_smufl_font(a0)if not a0 then a0=finale.FCFontInfo()a0:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=u.finale_version(27,1)then if nil~=a0.IsSMuFLFont then return a0.IsSMuFLFont end end;local a7=u.get_smufl_metadata_file(a0)if nil~=a7 then io.close(a7)return true end;return false end;function u.simple_input(a8,a9)local aa=finale.FCString()aa.LuaString=""local ab=finale.FCString()local ac=160;function format_ctrl(ad,ae,af,ag)ad:SetHeight(ae)ad:SetWidth(af)ab.LuaString=ag;ad:SetText(ab)end;title_width=string.len(a8)*6+54;if title_width>ac then ac=title_width end;text_width=string.len(a9)*6;if text_width>ac then ac=text_width end;ab.LuaString=a8;local ah=finale.FCCustomLuaWindow()ah:SetTitle(ab)local ai=ah:CreateStatic(0,0)format_ctrl(ai,16,ac,a9)local aj=ah:CreateEdit(0,20)format_ctrl(aj,20,ac,"")ah:CreateOkButton()ah:CreateCancelButton()function callback(ad)end;ah:RegisterHandleCommand(callback)if ah:ExecuteModal(nil)==finale.EXECMODAL_OK then aa.LuaString=aj:GetText(aa)return aa.LuaString end end;function u.is_finale_object(ak)return ak and type(ak)=="userdata"and ak.ClassName and ak.GetClassID and true or false end;function u.system_indent_set_to_prefs(S,Z)Z=Z or u.get_page_format_prefs()local al=finale.FCMeasure()local am=S.FirstMeasure==1;if not am and al:Load(S.FirstMeasure)then if al.ShowFullNames then am=true end end;if am and Z.UseFirstSystemMargins then S.LeftMargin=Z.FirstSystemLeft else S.LeftMargin=Z.SystemLeft end;return S:Save()end;return u end)c("library.layer",function(require,n,c,d)local u={}function u.finale_version(v,w,x)local y=bit32.bor(bit32.lshift(math.floor(v),24),bit32.lshift(math.floor(w),20))if x then y=bit32.bor(y,math.floor(x))end;return y end;function u.group_overlaps_region(z,q)if q:IsFullDocumentSpan()then return true end;local A=false;local B=finale.FCSystemStaves()B:LoadAllForRegion(q)for C in each(B)do if z:ContainsStaff(C:GetStaff())then A=true;break end end;if not A then return false end;if z.StartMeasure>q.EndMeasure or z.EndMeasure<q.StartMeasure then return false end;return true end;function u.group_is_contained_in_region(z,q)if not q:IsStaffIncluded(z.StartStaff)then return false end;if not q:IsStaffIncluded(z.EndStaff)then return false end;return true end;function u.staff_group_is_multistaff_instrument(z)local D=finale.FCMultiStaffInstruments()D:LoadAll()for E in each(D)do if E:ContainsStaff(z.StartStaff)and E.GroupID==z:GetItemID()then return true end end;return false end;function u.get_selected_region_or_whole_doc()local F=finenv.Region()if F:IsEmpty()then F:SetFullDocument()end;return F end;function u.get_first_cell_on_or_after_page(G)local H=G;local I=finale.FCPage()local J=false;while I:Load(H)do if I:GetFirstSystem()>0 then J=true;break end;H=H+1 end;if J then local K=finale.FCStaffSystem()K:Load(I:GetFirstSystem())return finale.FCCell(K.FirstMeasure,K.TopStaff)end;local L=finale.FCMusicRegion()L:SetFullDocument()return finale.FCCell(L.EndMeasure,L.EndStaff)end;function u.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local M=finale.FCMusicRegion()M:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),M.StartStaff)end;return u.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function u.get_top_left_selected_or_visible_cell()local F=finenv.Region()if not F:IsEmpty()then return finale.FCCell(F.StartMeasure,F.StartStaff)end;return u.get_top_left_visible_cell()end;function u.is_default_measure_number_visible_on_cell(N,O,P,Q)local R=finale.FCCurrentStaffSpec()if not R:LoadForCell(O,0)then return false end;if N:GetShowOnTopStaff()and O.Staff==P.TopStaff then return true end;if N:GetShowOnBottomStaff()and O.Staff==P:CalcBottomStaff()then return true end;if R.ShowMeasureNumbers then return not N:GetExcludeOtherStaves(Q)end;return false end;function u.is_default_number_visible_and_left_aligned(N,O,S,Q,T)if N.UseScoreInfoForParts then Q=false end;if T and N:GetShowOnMultiMeasureRests(Q)then if finale.MNALIGN_LEFT~=N:GetMultiMeasureAlignment(Q)then return false end elseif O.Measure==S.FirstMeasure then if not N:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=N:GetStartAlignment(Q)then return false end else if not N:GetShowMultiples(Q)then return false end;if finale.MNALIGN_LEFT~=N:GetMultipleAlignment(Q)then return false end end;return u.is_default_measure_number_visible_on_cell(N,O,S,Q)end;function u.update_layout(U,V)U=U or 1;V=V or false;local W=finale.FCPage()if W:Load(U)then W:UpdateLayout(V)end end;function u.get_current_part()local X=finale.FCParts()X:LoadAll()return X:GetCurrent()end;function u.get_page_format_prefs()local Y=u.get_current_part()local Z=finale.FCPageFormatPrefs()local _=false;if Y:IsScore()then _=Z:LoadScore()else _=Z:LoadParts()end;return Z,_ end;function u.get_smufl_metadata_file(a0)if not a0 then a0=finale.FCFontInfo()a0:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local a1=function(a2,a0)local a3=a2 .."/SMuFL/Fonts/"..a0.Name.."/"..a0.Name..".json"return io.open(a3,"r")end;local a4=""if finenv.UI():IsOnWindows()then a4=os.getenv("LOCALAPPDATA")else a4=os.getenv("HOME").."/Library/Application Support"end;local a5=a1(a4,a0)if nil~=a5 then return a5 end;local a6="/Library/Application Support"if finenv.UI():IsOnWindows()then a6=os.getenv("COMMONPROGRAMFILES")end;return a1(a6,a0)end;function u.is_font_smufl_font(a0)if not a0 then a0=finale.FCFontInfo()a0:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=u.finale_version(27,1)then if nil~=a0.IsSMuFLFont then return a0.IsSMuFLFont end end;local a7=u.get_smufl_metadata_file(a0)if nil~=a7 then io.close(a7)return true end;return false end;function u.simple_input(a8,a9)local aa=finale.FCString()aa.LuaString=""local ab=finale.FCString()local ac=160;function format_ctrl(ad,ae,af,ag)ad:SetHeight(ae)ad:SetWidth(af)ab.LuaString=ag;ad:SetText(ab)end;title_width=string.len(a8)*6+54;if title_width>ac then ac=title_width end;text_width=string.len(a9)*6;if text_width>ac then ac=text_width end;ab.LuaString=a8;local ah=finale.FCCustomLuaWindow()ah:SetTitle(ab)local ai=ah:CreateStatic(0,0)format_ctrl(ai,16,ac,a9)local aj=ah:CreateEdit(0,20)format_ctrl(aj,20,ac,"")ah:CreateOkButton()ah:CreateCancelButton()function callback(ad)end;ah:RegisterHandleCommand(callback)if ah:ExecuteModal(nil)==finale.EXECMODAL_OK then aa.LuaString=aj:GetText(aa)return aa.LuaString end end;function u.is_finale_object(ak)return ak and type(ak)=="userdata"and ak.ClassName and ak.GetClassID and true or false end;function u.system_indent_set_to_prefs(S,Z)Z=Z or u.get_page_format_prefs()local al=finale.FCMeasure()local am=S.FirstMeasure==1;if not am and al:Load(S.FirstMeasure)then if al.ShowFullNames then am=true end end;if am and Z.UseFirstSystemMargins then S.LeftMargin=Z.FirstSystemLeft else S.LeftMargin=Z.SystemLeft end;return S:Save()end;return u end)return a("__root")