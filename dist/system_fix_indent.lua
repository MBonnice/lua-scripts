local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.RequireSelection=false;finaleplugin.Author="Robert Patterson"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.1"finaleplugin.Date="April 23, 2022"finaleplugin.CategoryTags="System"finaleplugin.AuthorURL="https://robertgpatterson.com"finaleplugin.Notes=[[
        This script replaces the Fix Indent function of the JW New Piece plugin. It behaves slightly differently, however.
        The JW New Piece plugin uses the indentation of System 1 for the other first systems, and it assumes 0 for
        non-first systems. This script gets those values out of Page Format For Score or Page Format For Parts,
        depending on whether we are currently viewing score or part.
    ]]return"Fix Indent From Doc. Settings","Fix Indent From Doc. Settings","Resets the left-side indentation of selected systems using the Page Format For options."end;local o=require("library.general_library")function system_fix_indent()local p=o.get_selected_region_or_whole_doc()local q=o.get_page_format_prefs()local r=finale.FCStaffSystems()r:LoadAll()local s=r:FindMeasureNumber(p.StartMeasure).ItemNo;local t=r:FindMeasureNumber(p.EndMeasure).ItemNo;for u=s,t do local v=r:GetItemAt(u-1)o.system_indent_set_to_prefs(v,q)end;o.update_layout()end;system_fix_indent()end)c("library.general_library",function(require,n,c,d)local o={}function o.finale_version(w,x,y)local z=bit32.bor(bit32.lshift(math.floor(w),24),bit32.lshift(math.floor(x),20))if y then z=bit32.bor(z,math.floor(y))end;return z end;function o.group_overlaps_region(A,p)if p:IsFullDocumentSpan()then return true end;local B=false;local C=finale.FCSystemStaves()C:LoadAllForRegion(p)for D in each(C)do if A:ContainsStaff(D:GetStaff())then B=true;break end end;if not B then return false end;if A.StartMeasure>p.EndMeasure or A.EndMeasure<p.StartMeasure then return false end;return true end;function o.group_is_contained_in_region(A,p)if not p:IsStaffIncluded(A.StartStaff)then return false end;if not p:IsStaffIncluded(A.EndStaff)then return false end;return true end;function o.staff_group_is_multistaff_instrument(A)local E=finale.FCMultiStaffInstruments()E:LoadAll()for F in each(E)do if F:ContainsStaff(A.StartStaff)and F.GroupID==A:GetItemID()then return true end end;return false end;function o.get_selected_region_or_whole_doc()local G=finenv.Region()if G:IsEmpty()then G:SetFullDocument()end;return G end;function o.get_first_cell_on_or_after_page(H)local I=H;local J=finale.FCPage()local K=false;while J:Load(I)do if J:GetFirstSystem()>0 then K=true;break end;I=I+1 end;if K then local L=finale.FCStaffSystem()L:Load(J:GetFirstSystem())return finale.FCCell(L.FirstMeasure,L.TopStaff)end;local M=finale.FCMusicRegion()M:SetFullDocument()return finale.FCCell(M.EndMeasure,M.EndStaff)end;function o.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local N=finale.FCMusicRegion()N:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),N.StartStaff)end;return o.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function o.get_top_left_selected_or_visible_cell()local G=finenv.Region()if not G:IsEmpty()then return finale.FCCell(G.StartMeasure,G.StartStaff)end;return o.get_top_left_visible_cell()end;function o.is_default_measure_number_visible_on_cell(O,P,Q,R)local S=finale.FCCurrentStaffSpec()if not S:LoadForCell(P,0)then return false end;if O:GetShowOnTopStaff()and P.Staff==Q.TopStaff then return true end;if O:GetShowOnBottomStaff()and P.Staff==Q:CalcBottomStaff()then return true end;if S.ShowMeasureNumbers then return not O:GetExcludeOtherStaves(R)end;return false end;function o.is_default_number_visible_and_left_aligned(O,P,v,R,T)if O.UseScoreInfoForParts then R=false end;if T and O:GetShowOnMultiMeasureRests(R)then if finale.MNALIGN_LEFT~=O:GetMultiMeasureAlignment(R)then return false end elseif P.Measure==v.FirstMeasure then if not O:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=O:GetStartAlignment(R)then return false end else if not O:GetShowMultiples(R)then return false end;if finale.MNALIGN_LEFT~=O:GetMultipleAlignment(R)then return false end end;return o.is_default_measure_number_visible_on_cell(O,P,v,R)end;function o.update_layout(U,V)U=U or 1;V=V or false;local W=finale.FCPage()if W:Load(U)then W:UpdateLayout(V)end end;function o.get_current_part()local X=finale.FCParts()X:LoadAll()return X:GetCurrent()end;function o.get_page_format_prefs()local Y=o.get_current_part()local q=finale.FCPageFormatPrefs()local Z=false;if Y:IsScore()then Z=q:LoadScore()else Z=q:LoadParts()end;return q,Z end;function o.get_smufl_metadata_file(_)if not _ then _=finale.FCFontInfo()_:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local a0=function(a1,_)local a2=a1 .."/SMuFL/Fonts/".._.Name.."/".._.Name..".json"return io.open(a2,"r")end;local a3=""if finenv.UI():IsOnWindows()then a3=os.getenv("LOCALAPPDATA")else a3=os.getenv("HOME").."/Library/Application Support"end;local a4=a0(a3,_)if nil~=a4 then return a4 end;local a5="/Library/Application Support"if finenv.UI():IsOnWindows()then a5=os.getenv("COMMONPROGRAMFILES")end;return a0(a5,_)end;function o.is_font_smufl_font(_)if not _ then _=finale.FCFontInfo()_:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=o.finale_version(27,1)then if nil~=_.IsSMuFLFont then return _.IsSMuFLFont end end;local a6=o.get_smufl_metadata_file(_)if nil~=a6 then io.close(a6)return true end;return false end;function o.simple_input(a7,a8)local a9=finale.FCString()a9.LuaString=""local aa=finale.FCString()local ab=160;function format_ctrl(ac,ad,ae,af)ac:SetHeight(ad)ac:SetWidth(ae)aa.LuaString=af;ac:SetText(aa)end;title_width=string.len(a7)*6+54;if title_width>ab then ab=title_width end;text_width=string.len(a8)*6;if text_width>ab then ab=text_width end;aa.LuaString=a7;local ag=finale.FCCustomLuaWindow()ag:SetTitle(aa)local ah=ag:CreateStatic(0,0)format_ctrl(ah,16,ab,a8)local ai=ag:CreateEdit(0,20)format_ctrl(ai,20,ab,"")ag:CreateOkButton()ag:CreateCancelButton()function callback(ac)end;ag:RegisterHandleCommand(callback)if ag:ExecuteModal(nil)==finale.EXECMODAL_OK then a9.LuaString=ai:GetText(a9)return a9.LuaString end end;function o.is_finale_object(aj)return aj and type(aj)=="userdata"and aj.ClassName and aj.GetClassID and true or false end;function o.system_indent_set_to_prefs(v,q)q=q or o.get_page_format_prefs()local ak=finale.FCMeasure()local al=v.FirstMeasure==1;if not al and ak:Load(v.FirstMeasure)then if ak.ShowFullNames then al=true end end;if al and q.UseFirstSystemMargins then v.LeftMargin=q.FirstSystemLeft else v.LeftMargin=q.SystemLeft end;return v:Save()end;return o end)return a("__root")