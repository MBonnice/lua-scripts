local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.RequireSelection=true;finaleplugin.Author="Nick Mazuk"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.0"finaleplugin.Date="June 20, 2020"finaleplugin.CategoryTags="System"finaleplugin.AuthorURL="https://nickmazuk.com"return"Move System Up","Move System Up","Moves the selected system up one space"end;local o=require("library.measurement")function system_move_up()local p=finenv.Region()local q=finale.FCStaffSystems()q:LoadAll()local r=p:GetStartMeasure()local s=p:GetEndMeasure()local t=q:FindMeasureNumber(r)local u=q:FindMeasureNumber(s)local v=t:GetItemNo()local w=u:GetItemNo()for x=v,w,1 do local t=q:GetItemAt(x-1)t.TopMargin=t.TopMargin+o.convert_to_EVPUs("-1s")t:Save()end end;system_move_up()end)c("library.measurement",function(require,n,c,d)local y={}function y.finale_version(z,A,B)local C=bit32.bor(bit32.lshift(math.floor(z),24),bit32.lshift(math.floor(A),20))if B then C=bit32.bor(C,math.floor(B))end;return C end;function y.group_overlaps_region(D,p)if p:IsFullDocumentSpan()then return true end;local E=false;local F=finale.FCSystemStaves()F:LoadAllForRegion(p)for G in each(F)do if D:ContainsStaff(G:GetStaff())then E=true;break end end;if not E then return false end;if D.StartMeasure>p.EndMeasure or D.EndMeasure<p.StartMeasure then return false end;return true end;function y.group_is_contained_in_region(D,p)if not p:IsStaffIncluded(D.StartStaff)then return false end;if not p:IsStaffIncluded(D.EndStaff)then return false end;return true end;function y.staff_group_is_multistaff_instrument(D)local H=finale.FCMultiStaffInstruments()H:LoadAll()for I in each(H)do if I:ContainsStaff(D.StartStaff)and I.GroupID==D:GetItemID()then return true end end;return false end;function y.get_selected_region_or_whole_doc()local J=finenv.Region()if J:IsEmpty()then J:SetFullDocument()end;return J end;function y.get_first_cell_on_or_after_page(K)local L=K;local M=finale.FCPage()local N=false;while M:Load(L)do if M:GetFirstSystem()>0 then N=true;break end;L=L+1 end;if N then local O=finale.FCStaffSystem()O:Load(M:GetFirstSystem())return finale.FCCell(O.FirstMeasure,O.TopStaff)end;local P=finale.FCMusicRegion()P:SetFullDocument()return finale.FCCell(P.EndMeasure,P.EndStaff)end;function y.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local Q=finale.FCMusicRegion()Q:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),Q.StartStaff)end;return y.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function y.get_top_left_selected_or_visible_cell()local J=finenv.Region()if not J:IsEmpty()then return finale.FCCell(J.StartMeasure,J.StartStaff)end;return y.get_top_left_visible_cell()end;function y.is_default_measure_number_visible_on_cell(R,S,T,U)local V=finale.FCCurrentStaffSpec()if not V:LoadForCell(S,0)then return false end;if R:GetShowOnTopStaff()and S.Staff==T.TopStaff then return true end;if R:GetShowOnBottomStaff()and S.Staff==T:CalcBottomStaff()then return true end;if V.ShowMeasureNumbers then return not R:GetExcludeOtherStaves(U)end;return false end;function y.is_default_number_visible_and_left_aligned(R,S,t,U,W)if R.UseScoreInfoForParts then U=false end;if W and R:GetShowOnMultiMeasureRests(U)then if finale.MNALIGN_LEFT~=R:GetMultiMeasureAlignment(U)then return false end elseif S.Measure==t.FirstMeasure then if not R:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=R:GetStartAlignment(U)then return false end else if not R:GetShowMultiples(U)then return false end;if finale.MNALIGN_LEFT~=R:GetMultipleAlignment(U)then return false end end;return y.is_default_measure_number_visible_on_cell(R,S,t,U)end;function y.update_layout(X,Y)X=X or 1;Y=Y or false;local Z=finale.FCPage()if Z:Load(X)then Z:UpdateLayout(Y)end end;function y.get_current_part()local _=finale.FCParts()_:LoadAll()return _:GetCurrent()end;function y.get_page_format_prefs()local a0=y.get_current_part()local a1=finale.FCPageFormatPrefs()local a2=false;if a0:IsScore()then a2=a1:LoadScore()else a2=a1:LoadParts()end;return a1,a2 end;local a3=function(a4)local a5=finenv.UI():IsOnWindows()local a6=function(a7,a8)if finenv.UI():IsOnWindows()then return a7 and os.getenv(a7)or""else return a8 and os.getenv(a8)or""end end;local a9=a4 and a6("LOCALAPPDATA","HOME")or a6("COMMONPROGRAMFILES")if not a5 then a9=a9 .."/Library/Application Support"end;a9=a9 .."/SMuFL/Fonts/"return a9 end;function y.get_smufl_font_list()local aa={}local ab=function(a4)local a9=a3(a4)local ac=function()if finenv.UI():IsOnWindows()then return io.popen('dir "'..a9 ..'" /b /ad')else return io.popen('ls "'..a9 ..'"')end end;local ad=function(ae)local af=finale.FCString()af.LuaString=ae;return finenv.UI():IsFontAvailable(af)end;for ae in ac():lines()do if not ae:find("%.")then ae=ae:gsub(" Bold","")ae=ae:gsub(" Italic","")local af=finale.FCString()af.LuaString=ae;if aa[ae]or ad(ae)then aa[ae]=a4 and"user"or"system"end end end end;ab(true)ab(false)return aa end;function y.get_smufl_metadata_file(ag)if not ag then ag=finale.FCFontInfo()ag:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local ah=function(ai,ag)local aj=ai..ag.Name.."/"..ag.Name..".json"return io.open(aj,"r")end;local ak=ah(a3(true),ag)if ak then return ak end;return ah(a3(false),ag)end;function y.is_font_smufl_font(ag)if not ag then ag=finale.FCFontInfo()ag:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=y.finale_version(27,1)then if nil~=ag.IsSMuFLFont then return ag.IsSMuFLFont end end;local al=y.get_smufl_metadata_file(ag)if nil~=al then io.close(al)return true end;return false end;function y.simple_input(am,an)local ao=finale.FCString()ao.LuaString=""local ap=finale.FCString()local aq=160;function format_ctrl(ar,as,at,au)ar:SetHeight(as)ar:SetWidth(at)ap.LuaString=au;ar:SetText(ap)end;title_width=string.len(am)*6+54;if title_width>aq then aq=title_width end;text_width=string.len(an)*6;if text_width>aq then aq=text_width end;ap.LuaString=am;local av=finale.FCCustomLuaWindow()av:SetTitle(ap)local aw=av:CreateStatic(0,0)format_ctrl(aw,16,aq,an)local ax=av:CreateEdit(0,20)format_ctrl(ax,20,aq,"")av:CreateOkButton()av:CreateCancelButton()function callback(ar)end;av:RegisterHandleCommand(callback)if av:ExecuteModal(nil)==finale.EXECMODAL_OK then ao.LuaString=ax:GetText(ao)return ao.LuaString end end;function y.is_finale_object(ay)return ay and type(ay)=="userdata"and ay.ClassName and ay.GetClassID and true or false end;function y.system_indent_set_to_prefs(t,a1)a1=a1 or y.get_page_format_prefs()local az=finale.FCMeasure()local aA=t.FirstMeasure==1;if not aA and az:Load(t.FirstMeasure)then if az.ShowFullNames then aA=true end end;if aA and a1.UseFirstSystemMargins then t.LeftMargin=a1.FirstSystemLeft else t.LeftMargin=a1.SystemLeft end;return t:Save()end;function y.calc_script_name(aB)local aC=finale.FCString()if finenv.RunningLuaFilePath then aC.LuaString=finenv.RunningLuaFilePath()else aC:SetRunningLuaFilePath()end;local aD=finale.FCString()aC:SplitToPathAndFile(nil,aD)local C=aD.LuaString;if not aB then C=C:match("(.+)%..+")if not C or C==""then C=aD.LuaString end end;return C end;return y end)return a("__root")