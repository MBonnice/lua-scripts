local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.Author="Robert Patterson"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.0"finaleplugin.Date="June 12, 2020"finaleplugin.CategoryTags="Staff"return"Groups Reset","Groups Reset","Deletes all groups except those starting on the first measure, and extends those for the entire length of the document."end;local o=require("library.general_library")function staff_groups_reset()local p=o.get_selected_region_or_whole_doc()local q=finale.FCGroups()q:LoadAll()for r in each(q)do if o.group_is_contained_in_region(r,p)then if r.StartMeasure==1 then r.EndMeasure=32767;r:Save()else r:DeleteData()end end end end;staff_groups_reset()end)c("library.general_library",function(require,n,c,d)local o={}function o.finale_version(s,t,u)local v=bit32.bor(bit32.lshift(math.floor(s),24),bit32.lshift(math.floor(t),20))if u then v=bit32.bor(v,math.floor(u))end;return v end;function o.group_overlaps_region(w,x)if x:IsFullDocumentSpan()then return true end;local y=false;local z=finale.FCSystemStaves()z:LoadAllForRegion(x)for A in each(z)do if w:ContainsStaff(A:GetStaff())then y=true;break end end;if not y then return false end;if w.StartMeasure>x.EndMeasure or w.EndMeasure<x.StartMeasure then return false end;return true end;function o.group_is_contained_in_region(w,x)if not x:IsStaffIncluded(w.StartStaff)then return false end;if not x:IsStaffIncluded(w.EndStaff)then return false end;return true end;function o.staff_group_is_multistaff_instrument(w)local B=finale.FCMultiStaffInstruments()B:LoadAll()for C in each(B)do if C:ContainsStaff(w.StartStaff)and C.GroupID==w:GetItemID()then return true end end;return false end;function o.get_selected_region_or_whole_doc()local p=finenv.Region()if p:IsEmpty()then p:SetFullDocument()end;return p end;function o.get_first_cell_on_or_after_page(D)local E=D;local F=finale.FCPage()local G=false;while F:Load(E)do if F:GetFirstSystem()>0 then G=true;break end;E=E+1 end;if G then local H=finale.FCStaffSystem()H:Load(F:GetFirstSystem())return finale.FCCell(H.FirstMeasure,H.TopStaff)end;local I=finale.FCMusicRegion()I:SetFullDocument()return finale.FCCell(I.EndMeasure,I.EndStaff)end;function o.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local J=finale.FCMusicRegion()J:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),J.StartStaff)end;return o.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function o.get_top_left_selected_or_visible_cell()local p=finenv.Region()if not p:IsEmpty()then return finale.FCCell(p.StartMeasure,p.StartStaff)end;return o.get_top_left_visible_cell()end;function o.is_default_measure_number_visible_on_cell(K,L,M,N)local O=finale.FCCurrentStaffSpec()if not O:LoadForCell(L,0)then return false end;if K:GetShowOnTopStaff()and L.Staff==M.TopStaff then return true end;if K:GetShowOnBottomStaff()and L.Staff==M:CalcBottomStaff()then return true end;if O.ShowMeasureNumbers then return not K:GetExcludeOtherStaves(N)end;return false end;function o.is_default_number_visible_and_left_aligned(K,L,P,N,Q)if K.UseScoreInfoForParts then N=false end;if Q and K:GetShowOnMultiMeasureRests(N)then if finale.MNALIGN_LEFT~=K:GetMultiMeasureAlignment(N)then return false end elseif L.Measure==P.FirstMeasure then if not K:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=K:GetStartAlignment(N)then return false end else if not K:GetShowMultiples(N)then return false end;if finale.MNALIGN_LEFT~=K:GetMultipleAlignment(N)then return false end end;return o.is_default_measure_number_visible_on_cell(K,L,P,N)end;function o.update_layout(R,S)R=R or 1;S=S or false;local T=finale.FCPage()if T:Load(R)then T:UpdateLayout(S)end end;function o.get_current_part()local U=finale.FCParts()U:LoadAll()return U:GetCurrent()end;function o.get_page_format_prefs()local V=o.get_current_part()local W=finale.FCPageFormatPrefs()local X=false;if V:IsScore()then X=W:LoadScore()else X=W:LoadParts()end;return W,X end;local Y=function(Z)local _=finenv.UI():IsOnWindows()local a0=function(a1,a2)if finenv.UI():IsOnWindows()then return a1 and os.getenv(a1)or""else return a2 and os.getenv(a2)or""end end;local a3=Z and a0("LOCALAPPDATA","HOME")or a0("COMMONPROGRAMFILES")if not _ then a3=a3 .."/Library/Application Support"end;a3=a3 .."/SMuFL/Fonts/"return a3 end;function o.get_smufl_font_list()local a4={}local a5=function(Z)local a3=Y(Z)local a6=function()if finenv.UI():IsOnWindows()then return io.popen('dir "'..a3 ..'" /b /ad')else return io.popen('ls "'..a3 ..'"')end end;local a7=function(a8)local a9=finale.FCString()a9.LuaString=a8;return finenv.UI():IsFontAvailable(a9)end;for a8 in a6():lines()do if not a8:find("%.")then a8=a8:gsub(" Bold","")a8=a8:gsub(" Italic","")local a9=finale.FCString()a9.LuaString=a8;if a4[a8]or a7(a8)then a4[a8]=Z and"user"or"system"end end end end;a5(true)a5(false)return a4 end;function o.get_smufl_metadata_file(aa)if not aa then aa=finale.FCFontInfo()aa:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local ab=function(ac,aa)local ad=ac..aa.Name.."/"..aa.Name..".json"return io.open(ad,"r")end;local ae=ab(Y(true),aa)if ae then return ae end;return ab(Y(false),aa)end;function o.is_font_smufl_font(aa)if not aa then aa=finale.FCFontInfo()aa:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=o.finale_version(27,1)then if nil~=aa.IsSMuFLFont then return aa.IsSMuFLFont end end;local af=o.get_smufl_metadata_file(aa)if nil~=af then io.close(af)return true end;return false end;function o.simple_input(ag,ah)local ai=finale.FCString()ai.LuaString=""local aj=finale.FCString()local ak=160;function format_ctrl(al,am,an,ao)al:SetHeight(am)al:SetWidth(an)aj.LuaString=ao;al:SetText(aj)end;title_width=string.len(ag)*6+54;if title_width>ak then ak=title_width end;text_width=string.len(ah)*6;if text_width>ak then ak=text_width end;aj.LuaString=ag;local ap=finale.FCCustomLuaWindow()ap:SetTitle(aj)local aq=ap:CreateStatic(0,0)format_ctrl(aq,16,ak,ah)local ar=ap:CreateEdit(0,20)format_ctrl(ar,20,ak,"")ap:CreateOkButton()ap:CreateCancelButton()function callback(al)end;ap:RegisterHandleCommand(callback)if ap:ExecuteModal(nil)==finale.EXECMODAL_OK then ai.LuaString=ar:GetText(ai)return ai.LuaString end end;function o.is_finale_object(as)return as and type(as)=="userdata"and as.ClassName and as.GetClassID and true or false end;function o.system_indent_set_to_prefs(P,W)W=W or o.get_page_format_prefs()local at=finale.FCMeasure()local au=P.FirstMeasure==1;if not au and at:Load(P.FirstMeasure)then if at.ShowFullNames then au=true end end;if au and W.UseFirstSystemMargins then P.LeftMargin=W.FirstSystemLeft else P.LeftMargin=W.SystemLeft end;return P:Save()end;function o.calc_script_name(av)local aw=finale.FCString()if finenv.RunningLuaFilePath then aw.LuaString=finenv.RunningLuaFilePath()else aw:SetRunningLuaFilePath()end;local ax=finale.FCString()aw:SplitToPathAndFile(nil,ax)local v=ax.LuaString;if not av then v=v:match("(.+)%..+")if not v or v==""then v=ax.LuaString end end;return v end;return o end)return a("__root")