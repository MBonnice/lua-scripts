function plugindef()finaleplugin.Author="Robert Patterson"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.0"finaleplugin.Date="June 27, 2020"finaleplugin.CategoryTags="Expression"finaleplugin.Notes=[[
        The Expression Selection Dialog expects expression definitions to be stored sequentially and stops looking for definitions
        once the next value is not found. However, Finale can leave orphaned expression definitions with higher values. These
        are inaccessible unless you add in dummy expressions to fill in the gaps. This script builds a report of any such
        expression definitions.
    ]]return"Expression Find Orphans","Expression Find Orphans","Reports any orphaned expression definitions not visible in the Expression Selection Dialog."end;local a="\n"local b=32767;local c=function(d,e)local f="Text Expression"if e then f="Shape Expression"end;local g=""local h=true;for i,j in pairs(d)do local k=nil;if e then k=finale.FCShapeExpressionDef()else k=finale.FCTextExpressionDef()end;if k:Load(j)then if not h then g=g..a end;h=false;g=g..f.." "..k.ItemNo;if not e then local l=finale.FCTextBlock()if l:Load(k.TextID)then local m=l:CreateRawTextString()if nil~=m then m:TrimEnigmaFontTags()g=g.." "..m.LuaString end end end end end;return g end;local n=function(e)local k=nil;if e then k=finale.FCShapeExpressionDef()else k=finale.FCTextExpressionDef()end;local o=0;local p=0;local q=0;local d={}for r=1,b do if k:Load(r)then q=k.ItemNo;o=o+1;if o~=k.ItemNo then table.insert(d,k.ItemNo)else p=o end end end;return d,p,q end;function expression_find_orphaned_definitions()local s,t,u=n(false)local v,w,x=n(true)local y=false;local g=""if#s>0 then y=true;g=g..c(s,false)end;if#v>0 then if y then g=g..a..a else y=true end;g=g..c(v,true)end;if y then g=g..a..a.."Max Valid Text = "..t..". Max Valid Shape = "..w.."."finenv.UI():AlertInfo(g,"Found Orphaned Expressions:")else finenv.UI():AlertInfo("","No Orphaned Expressions Found")end end;expression_find_orphaned_definitions()