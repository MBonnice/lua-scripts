local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.Author="Robert Patterson"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.0.2"finaleplugin.Date="June 12, 2020"finaleplugin.CategoryTags="Staff"finaleplugin.Notes=[[
        This script only affects selected staves.
        If you select the entire document before running this script, it modifies any
        full staff names found in staff styles as well.
    ]]return"Reset Full Staff Name Fonts","Reset Full Staff Name Fonts","Reset all full staff names to document's default font settings."end;local o=require("library.general_library")local p=require("library.enigma_string")function prefs_reset_staff_full_name_fonts()local q=o.get_selected_region_or_whole_doc()local r=finale.FCFontInfo()r:LoadFontPrefs(finale.FONTPREF_STAFFNAME)local s=finale.FCSystemStaves()s:LoadAllForRegion(q)for t in each(s)do local u=finale.FCStaff()u:Load(t:GetStaff())local v=u:GetFullNameID()if 0~=v then text_block=finale.FCTextBlock()if text_block:Load(v)then if p.change_first_text_block_font(text_block,r)then text_block:Save()end end end end;if q:IsFullDocumentSpan()then local w=finale.FCStaffStyleDefs()w:LoadAll()for x in each(w)do if x.UseFullName then text_block=finale.FCTextBlock()if text_block:Load(x:GetFullNameID())then if p.change_first_text_block_font(text_block,r)then text_block:Save()end end end end end end;prefs_reset_staff_full_name_fonts()end)c("library.enigma_string",function(require,n,c,d)local o={}function o.finale_version(y,z,A)local B=bit32.bor(bit32.lshift(math.floor(y),24),bit32.lshift(math.floor(z),20))if A then B=bit32.bor(B,math.floor(A))end;return B end;function o.group_overlaps_region(C,D)if D:IsFullDocumentSpan()then return true end;local E=false;local s=finale.FCSystemStaves()s:LoadAllForRegion(D)for t in each(s)do if C:ContainsStaff(t:GetStaff())then E=true;break end end;if not E then return false end;if C.StartMeasure>D.EndMeasure or C.EndMeasure<D.StartMeasure then return false end;return true end;function o.group_is_contained_in_region(C,D)if not D:IsStaffIncluded(C.StartStaff)then return false end;if not D:IsStaffIncluded(C.EndStaff)then return false end;return true end;function o.staff_group_is_multistaff_instrument(C)local F=finale.FCMultiStaffInstruments()F:LoadAll()for G in each(F)do if G:ContainsStaff(C.StartStaff)and G.GroupID==C:GetItemID()then return true end end;return false end;function o.get_selected_region_or_whole_doc()local q=finenv.Region()if q:IsEmpty()then q:SetFullDocument()end;return q end;function o.get_first_cell_on_or_after_page(H)local I=H;local J=finale.FCPage()local K=false;while J:Load(I)do if J:GetFirstSystem()>0 then K=true;break end;I=I+1 end;if K then local L=finale.FCStaffSystem()L:Load(J:GetFirstSystem())return finale.FCCell(L.FirstMeasure,L.TopStaff)end;local M=finale.FCMusicRegion()M:SetFullDocument()return finale.FCCell(M.EndMeasure,M.EndStaff)end;function o.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local N=finale.FCMusicRegion()N:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),N.StartStaff)end;return o.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function o.get_top_left_selected_or_visible_cell()local q=finenv.Region()if not q:IsEmpty()then return finale.FCCell(q.StartMeasure,q.StartStaff)end;return o.get_top_left_visible_cell()end;function o.is_default_measure_number_visible_on_cell(O,P,Q,R)local u=finale.FCCurrentStaffSpec()if not u:LoadForCell(P,0)then return false end;if O:GetShowOnTopStaff()and P.Staff==Q.TopStaff then return true end;if O:GetShowOnBottomStaff()and P.Staff==Q:CalcBottomStaff()then return true end;if u.ShowMeasureNumbers then return not O:GetExcludeOtherStaves(R)end;return false end;function o.is_default_number_visible_and_left_aligned(O,P,S,R,T)if O.UseScoreInfoForParts then R=false end;if T and O:GetShowOnMultiMeasureRests(R)then if finale.MNALIGN_LEFT~=O:GetMultiMeasureAlignment(R)then return false end elseif P.Measure==S.FirstMeasure then if not O:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=O:GetStartAlignment(R)then return false end else if not O:GetShowMultiples(R)then return false end;if finale.MNALIGN_LEFT~=O:GetMultipleAlignment(R)then return false end end;return o.is_default_measure_number_visible_on_cell(O,P,S,R)end;function o.update_layout(U,V)U=U or 1;V=V or false;local W=finale.FCPage()if W:Load(U)then W:UpdateLayout(V)end end;function o.get_current_part()local X=finale.FCParts()X:LoadAll()return X:GetCurrent()end;function o.get_page_format_prefs()local Y=o.get_current_part()local Z=finale.FCPageFormatPrefs()local _=false;if Y:IsScore()then _=Z:LoadScore()else _=Z:LoadParts()end;return Z,_ end;function o.get_smufl_metadata_file(r)if not r then r=finale.FCFontInfo()r:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local a0=function(a1,r)local a2=a1 .."/SMuFL/Fonts/"..r.Name.."/"..r.Name..".json"return io.open(a2,"r")end;local a3=""if finenv.UI():IsOnWindows()then a3=os.getenv("LOCALAPPDATA")else a3=os.getenv("HOME").."/Library/Application Support"end;local a4=a0(a3,r)if nil~=a4 then return a4 end;local a5="/Library/Application Support"if finenv.UI():IsOnWindows()then a5=os.getenv("COMMONPROGRAMFILES")end;return a0(a5,r)end;function o.is_font_smufl_font(r)if not r then r=finale.FCFontInfo()r:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=o.finale_version(27,1)then if nil~=r.IsSMuFLFont then return r.IsSMuFLFont end end;local a6=o.get_smufl_metadata_file(r)if nil~=a6 then io.close(a6)return true end;return false end;function o.simple_input(a7,a8)local a9=finale.FCString()a9.LuaString=""local aa=finale.FCString()local ab=160;function format_ctrl(ac,ad,ae,af)ac:SetHeight(ad)ac:SetWidth(ae)aa.LuaString=af;ac:SetText(aa)end;title_width=string.len(a7)*6+54;if title_width>ab then ab=title_width end;text_width=string.len(a8)*6;if text_width>ab then ab=text_width end;aa.LuaString=a7;local ag=finale.FCCustomLuaWindow()ag:SetTitle(aa)local ah=ag:CreateStatic(0,0)format_ctrl(ah,16,ab,a8)local ai=ag:CreateEdit(0,20)format_ctrl(ai,20,ab,"")ag:CreateOkButton()ag:CreateCancelButton()function callback(ac)end;ag:RegisterHandleCommand(callback)if ag:ExecuteModal(nil)==finale.EXECMODAL_OK then a9.LuaString=ai:GetText(a9)return a9.LuaString end end;function o.is_finale_object(aj)return aj and type(aj)=="userdata"and aj.ClassName and aj.GetClassID and true or false end;function o.system_indent_set_to_prefs(S,Z)Z=Z or o.get_page_format_prefs()local ak=finale.FCMeasure()local al=S.FirstMeasure==1;if not al and ak:Load(S.FirstMeasure)then if ak.ShowFullNames then al=true end end;if al and Z.UseFirstSystemMargins then S.LeftMargin=Z.FirstSystemLeft else S.LeftMargin=Z.SystemLeft end;return S:Save()end;return o end)c("library.general_library",function(require,n,c,d)local o={}function o.finale_version(y,z,A)local B=bit32.bor(bit32.lshift(math.floor(y),24),bit32.lshift(math.floor(z),20))if A then B=bit32.bor(B,math.floor(A))end;return B end;function o.group_overlaps_region(C,D)if D:IsFullDocumentSpan()then return true end;local E=false;local s=finale.FCSystemStaves()s:LoadAllForRegion(D)for t in each(s)do if C:ContainsStaff(t:GetStaff())then E=true;break end end;if not E then return false end;if C.StartMeasure>D.EndMeasure or C.EndMeasure<D.StartMeasure then return false end;return true end;function o.group_is_contained_in_region(C,D)if not D:IsStaffIncluded(C.StartStaff)then return false end;if not D:IsStaffIncluded(C.EndStaff)then return false end;return true end;function o.staff_group_is_multistaff_instrument(C)local F=finale.FCMultiStaffInstruments()F:LoadAll()for G in each(F)do if G:ContainsStaff(C.StartStaff)and G.GroupID==C:GetItemID()then return true end end;return false end;function o.get_selected_region_or_whole_doc()local q=finenv.Region()if q:IsEmpty()then q:SetFullDocument()end;return q end;function o.get_first_cell_on_or_after_page(H)local I=H;local J=finale.FCPage()local K=false;while J:Load(I)do if J:GetFirstSystem()>0 then K=true;break end;I=I+1 end;if K then local L=finale.FCStaffSystem()L:Load(J:GetFirstSystem())return finale.FCCell(L.FirstMeasure,L.TopStaff)end;local M=finale.FCMusicRegion()M:SetFullDocument()return finale.FCCell(M.EndMeasure,M.EndStaff)end;function o.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local N=finale.FCMusicRegion()N:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),N.StartStaff)end;return o.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function o.get_top_left_selected_or_visible_cell()local q=finenv.Region()if not q:IsEmpty()then return finale.FCCell(q.StartMeasure,q.StartStaff)end;return o.get_top_left_visible_cell()end;function o.is_default_measure_number_visible_on_cell(O,P,Q,R)local u=finale.FCCurrentStaffSpec()if not u:LoadForCell(P,0)then return false end;if O:GetShowOnTopStaff()and P.Staff==Q.TopStaff then return true end;if O:GetShowOnBottomStaff()and P.Staff==Q:CalcBottomStaff()then return true end;if u.ShowMeasureNumbers then return not O:GetExcludeOtherStaves(R)end;return false end;function o.is_default_number_visible_and_left_aligned(O,P,S,R,T)if O.UseScoreInfoForParts then R=false end;if T and O:GetShowOnMultiMeasureRests(R)then if finale.MNALIGN_LEFT~=O:GetMultiMeasureAlignment(R)then return false end elseif P.Measure==S.FirstMeasure then if not O:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=O:GetStartAlignment(R)then return false end else if not O:GetShowMultiples(R)then return false end;if finale.MNALIGN_LEFT~=O:GetMultipleAlignment(R)then return false end end;return o.is_default_measure_number_visible_on_cell(O,P,S,R)end;function o.update_layout(U,V)U=U or 1;V=V or false;local W=finale.FCPage()if W:Load(U)then W:UpdateLayout(V)end end;function o.get_current_part()local X=finale.FCParts()X:LoadAll()return X:GetCurrent()end;function o.get_page_format_prefs()local Y=o.get_current_part()local Z=finale.FCPageFormatPrefs()local _=false;if Y:IsScore()then _=Z:LoadScore()else _=Z:LoadParts()end;return Z,_ end;function o.get_smufl_metadata_file(r)if not r then r=finale.FCFontInfo()r:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local a0=function(a1,r)local a2=a1 .."/SMuFL/Fonts/"..r.Name.."/"..r.Name..".json"return io.open(a2,"r")end;local a3=""if finenv.UI():IsOnWindows()then a3=os.getenv("LOCALAPPDATA")else a3=os.getenv("HOME").."/Library/Application Support"end;local a4=a0(a3,r)if nil~=a4 then return a4 end;local a5="/Library/Application Support"if finenv.UI():IsOnWindows()then a5=os.getenv("COMMONPROGRAMFILES")end;return a0(a5,r)end;function o.is_font_smufl_font(r)if not r then r=finale.FCFontInfo()r:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=o.finale_version(27,1)then if nil~=r.IsSMuFLFont then return r.IsSMuFLFont end end;local a6=o.get_smufl_metadata_file(r)if nil~=a6 then io.close(a6)return true end;return false end;function o.simple_input(a7,a8)local a9=finale.FCString()a9.LuaString=""local aa=finale.FCString()local ab=160;function format_ctrl(ac,ad,ae,af)ac:SetHeight(ad)ac:SetWidth(ae)aa.LuaString=af;ac:SetText(aa)end;title_width=string.len(a7)*6+54;if title_width>ab then ab=title_width end;text_width=string.len(a8)*6;if text_width>ab then ab=text_width end;aa.LuaString=a7;local ag=finale.FCCustomLuaWindow()ag:SetTitle(aa)local ah=ag:CreateStatic(0,0)format_ctrl(ah,16,ab,a8)local ai=ag:CreateEdit(0,20)format_ctrl(ai,20,ab,"")ag:CreateOkButton()ag:CreateCancelButton()function callback(ac)end;ag:RegisterHandleCommand(callback)if ag:ExecuteModal(nil)==finale.EXECMODAL_OK then a9.LuaString=ai:GetText(a9)return a9.LuaString end end;function o.is_finale_object(aj)return aj and type(aj)=="userdata"and aj.ClassName and aj.GetClassID and true or false end;function o.system_indent_set_to_prefs(S,Z)Z=Z or o.get_page_format_prefs()local ak=finale.FCMeasure()local al=S.FirstMeasure==1;if not al and ak:Load(S.FirstMeasure)then if ak.ShowFullNames then al=true end end;if al and Z.UseFirstSystemMargins then S.LeftMargin=Z.FirstSystemLeft else S.LeftMargin=Z.SystemLeft end;return S:Save()end;return o end)return a("__root")