local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.RequireSelection=true;finaleplugin.Author="Robert Patterson"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.0"finaleplugin.Date="March 20, 2021"finaleplugin.CategoryTags="Expression"return"Expression Set To Parts Only","Expression Set To Parts Only","Set any single-staff text expression in the currenly selected region to Parts Only assignment."end;local o=require("library.general_library")local p=require("library.expression")function expression_set_to_parts_only()local q=o.get_current_part()local r=finale.FCExpressions()r:LoadAllForRegion(finenv.Region())for s in each(r)do if 0==s.StaffListID then if p.is_for_current_part(s,q)then s.ScoreAssignment=false;s.PartAssignment=true;s:Save()end end end end;expression_set_to_parts_only()end)c("library.expression",function(require,n,c,d)local o={}function o.finale_version(t,u,v)local w=bit32.bor(bit32.lshift(math.floor(t),24),bit32.lshift(math.floor(u),20))if v then w=bit32.bor(w,math.floor(v))end;return w end;function o.group_overlaps_region(x,y)if y:IsFullDocumentSpan()then return true end;local z=false;local A=finale.FCSystemStaves()A:LoadAllForRegion(y)for B in each(A)do if x:ContainsStaff(B:GetStaff())then z=true;break end end;if not z then return false end;if x.StartMeasure>y.EndMeasure or x.EndMeasure<y.StartMeasure then return false end;return true end;function o.group_is_contained_in_region(x,y)if not y:IsStaffIncluded(x.StartStaff)then return false end;if not y:IsStaffIncluded(x.EndStaff)then return false end;return true end;function o.staff_group_is_multistaff_instrument(x)local C=finale.FCMultiStaffInstruments()C:LoadAll()for D in each(C)do if D:ContainsStaff(x.StartStaff)and D.GroupID==x:GetItemID()then return true end end;return false end;function o.get_selected_region_or_whole_doc()local E=finenv.Region()if E:IsEmpty()then E:SetFullDocument()end;return E end;function o.get_first_cell_on_or_after_page(F)local G=F;local H=finale.FCPage()local I=false;while H:Load(G)do if H:GetFirstSystem()>0 then I=true;break end;G=G+1 end;if I then local J=finale.FCStaffSystem()J:Load(H:GetFirstSystem())return finale.FCCell(J.FirstMeasure,J.TopStaff)end;local K=finale.FCMusicRegion()K:SetFullDocument()return finale.FCCell(K.EndMeasure,K.EndStaff)end;function o.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local L=finale.FCMusicRegion()L:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),L.StartStaff)end;return o.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function o.get_top_left_selected_or_visible_cell()local E=finenv.Region()if not E:IsEmpty()then return finale.FCCell(E.StartMeasure,E.StartStaff)end;return o.get_top_left_visible_cell()end;function o.is_default_measure_number_visible_on_cell(M,N,O,P)local Q=finale.FCCurrentStaffSpec()if not Q:LoadForCell(N,0)then return false end;if M:GetShowOnTopStaff()and N.Staff==O.TopStaff then return true end;if M:GetShowOnBottomStaff()and N.Staff==O:CalcBottomStaff()then return true end;if Q.ShowMeasureNumbers then return not M:GetExcludeOtherStaves(P)end;return false end;function o.is_default_number_visible_and_left_aligned(M,N,R,P,S)if M.UseScoreInfoForParts then P=false end;if S and M:GetShowOnMultiMeasureRests(P)then if finale.MNALIGN_LEFT~=M:GetMultiMeasureAlignment(P)then return false end elseif N.Measure==R.FirstMeasure then if not M:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=M:GetStartAlignment(P)then return false end else if not M:GetShowMultiples(P)then return false end;if finale.MNALIGN_LEFT~=M:GetMultipleAlignment(P)then return false end end;return o.is_default_measure_number_visible_on_cell(M,N,R,P)end;function o.update_layout(T,U)T=T or 1;U=U or false;local V=finale.FCPage()if V:Load(T)then V:UpdateLayout(U)end end;function o.get_current_part()local W=finale.FCParts()W:LoadAll()return W:GetCurrent()end;function o.get_page_format_prefs()local q=o.get_current_part()local X=finale.FCPageFormatPrefs()local Y=false;if q:IsScore()then Y=X:LoadScore()else Y=X:LoadParts()end;return X,Y end;local Z=function(_)local a0=finenv.UI():IsOnWindows()local a1=function(a2,a3)if finenv.UI():IsOnWindows()then return a2 and os.getenv(a2)or""else return a3 and os.getenv(a3)or""end end;local a4=_ and a1("LOCALAPPDATA","HOME")or a1("COMMONPROGRAMFILES")if not a0 then a4=a4 .."/Library/Application Support"end;a4=a4 .."/SMuFL/Fonts/"return a4 end;function o.get_smufl_font_list()local a5={}local a6=function(_)local a4=Z(_)local a7=function()if finenv.UI():IsOnWindows()then return io.popen('dir "'..a4 ..'" /b /ad')else return io.popen('ls "'..a4 ..'"')end end;local a8=function(a9)local aa=finale.FCString()aa.LuaString=a9;return finenv.UI():IsFontAvailable(aa)end;for a9 in a7():lines()do if not a9:find("%.")then a9=a9:gsub(" Bold","")a9=a9:gsub(" Italic","")local aa=finale.FCString()aa.LuaString=a9;if a5[a9]or a8(a9)then a5[a9]=_ and"user"or"system"end end end end;a6(true)a6(false)return a5 end;function o.get_smufl_metadata_file(ab)if not ab then ab=finale.FCFontInfo()ab:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local ac=function(ad,ab)local ae=ad..ab.Name.."/"..ab.Name..".json"return io.open(ae,"r")end;local af=ac(Z(true),ab)if af then return af end;return ac(Z(false),ab)end;function o.is_font_smufl_font(ab)if not ab then ab=finale.FCFontInfo()ab:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=o.finale_version(27,1)then if nil~=ab.IsSMuFLFont then return ab.IsSMuFLFont end end;local ag=o.get_smufl_metadata_file(ab)if nil~=ag then io.close(ag)return true end;return false end;function o.simple_input(ah,ai)local aj=finale.FCString()aj.LuaString=""local ak=finale.FCString()local al=160;function format_ctrl(am,an,ao,ap)am:SetHeight(an)am:SetWidth(ao)ak.LuaString=ap;am:SetText(ak)end;title_width=string.len(ah)*6+54;if title_width>al then al=title_width end;text_width=string.len(ai)*6;if text_width>al then al=text_width end;ak.LuaString=ah;local aq=finale.FCCustomLuaWindow()aq:SetTitle(ak)local ar=aq:CreateStatic(0,0)format_ctrl(ar,16,al,ai)local as=aq:CreateEdit(0,20)format_ctrl(as,20,al,"")aq:CreateOkButton()aq:CreateCancelButton()function callback(am)end;aq:RegisterHandleCommand(callback)if aq:ExecuteModal(nil)==finale.EXECMODAL_OK then aj.LuaString=as:GetText(aj)return aj.LuaString end end;function o.is_finale_object(at)return at and type(at)=="userdata"and at.ClassName and at.GetClassID and true or false end;function o.system_indent_set_to_prefs(R,X)X=X or o.get_page_format_prefs()local au=finale.FCMeasure()local av=R.FirstMeasure==1;if not av and au:Load(R.FirstMeasure)then if au.ShowFullNames then av=true end end;if av and X.UseFirstSystemMargins then R.LeftMargin=X.FirstSystemLeft else R.LeftMargin=X.SystemLeft end;return R:Save()end;function o.calc_script_name(aw)local ax=finale.FCString()if finenv.RunningLuaFilePath then ax.LuaString=finenv.RunningLuaFilePath()else ax:SetRunningLuaFilePath()end;local ay=finale.FCString()ax:SplitToPathAndFile(nil,ay)local w=ay.LuaString;if not aw then w=w:match("(.+)%..+")if not w or w==""then w=ay.LuaString end end;return w end;return o end)c("library.general_library",function(require,n,c,d)local o={}function o.finale_version(t,u,v)local w=bit32.bor(bit32.lshift(math.floor(t),24),bit32.lshift(math.floor(u),20))if v then w=bit32.bor(w,math.floor(v))end;return w end;function o.group_overlaps_region(x,y)if y:IsFullDocumentSpan()then return true end;local z=false;local A=finale.FCSystemStaves()A:LoadAllForRegion(y)for B in each(A)do if x:ContainsStaff(B:GetStaff())then z=true;break end end;if not z then return false end;if x.StartMeasure>y.EndMeasure or x.EndMeasure<y.StartMeasure then return false end;return true end;function o.group_is_contained_in_region(x,y)if not y:IsStaffIncluded(x.StartStaff)then return false end;if not y:IsStaffIncluded(x.EndStaff)then return false end;return true end;function o.staff_group_is_multistaff_instrument(x)local C=finale.FCMultiStaffInstruments()C:LoadAll()for D in each(C)do if D:ContainsStaff(x.StartStaff)and D.GroupID==x:GetItemID()then return true end end;return false end;function o.get_selected_region_or_whole_doc()local E=finenv.Region()if E:IsEmpty()then E:SetFullDocument()end;return E end;function o.get_first_cell_on_or_after_page(F)local G=F;local H=finale.FCPage()local I=false;while H:Load(G)do if H:GetFirstSystem()>0 then I=true;break end;G=G+1 end;if I then local J=finale.FCStaffSystem()J:Load(H:GetFirstSystem())return finale.FCCell(J.FirstMeasure,J.TopStaff)end;local K=finale.FCMusicRegion()K:SetFullDocument()return finale.FCCell(K.EndMeasure,K.EndStaff)end;function o.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local L=finale.FCMusicRegion()L:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),L.StartStaff)end;return o.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function o.get_top_left_selected_or_visible_cell()local E=finenv.Region()if not E:IsEmpty()then return finale.FCCell(E.StartMeasure,E.StartStaff)end;return o.get_top_left_visible_cell()end;function o.is_default_measure_number_visible_on_cell(M,N,O,P)local Q=finale.FCCurrentStaffSpec()if not Q:LoadForCell(N,0)then return false end;if M:GetShowOnTopStaff()and N.Staff==O.TopStaff then return true end;if M:GetShowOnBottomStaff()and N.Staff==O:CalcBottomStaff()then return true end;if Q.ShowMeasureNumbers then return not M:GetExcludeOtherStaves(P)end;return false end;function o.is_default_number_visible_and_left_aligned(M,N,R,P,S)if M.UseScoreInfoForParts then P=false end;if S and M:GetShowOnMultiMeasureRests(P)then if finale.MNALIGN_LEFT~=M:GetMultiMeasureAlignment(P)then return false end elseif N.Measure==R.FirstMeasure then if not M:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=M:GetStartAlignment(P)then return false end else if not M:GetShowMultiples(P)then return false end;if finale.MNALIGN_LEFT~=M:GetMultipleAlignment(P)then return false end end;return o.is_default_measure_number_visible_on_cell(M,N,R,P)end;function o.update_layout(T,U)T=T or 1;U=U or false;local V=finale.FCPage()if V:Load(T)then V:UpdateLayout(U)end end;function o.get_current_part()local W=finale.FCParts()W:LoadAll()return W:GetCurrent()end;function o.get_page_format_prefs()local q=o.get_current_part()local X=finale.FCPageFormatPrefs()local Y=false;if q:IsScore()then Y=X:LoadScore()else Y=X:LoadParts()end;return X,Y end;local Z=function(_)local a0=finenv.UI():IsOnWindows()local a1=function(a2,a3)if finenv.UI():IsOnWindows()then return a2 and os.getenv(a2)or""else return a3 and os.getenv(a3)or""end end;local a4=_ and a1("LOCALAPPDATA","HOME")or a1("COMMONPROGRAMFILES")if not a0 then a4=a4 .."/Library/Application Support"end;a4=a4 .."/SMuFL/Fonts/"return a4 end;function o.get_smufl_font_list()local a5={}local a6=function(_)local a4=Z(_)local a7=function()if finenv.UI():IsOnWindows()then return io.popen('dir "'..a4 ..'" /b /ad')else return io.popen('ls "'..a4 ..'"')end end;local a8=function(a9)local aa=finale.FCString()aa.LuaString=a9;return finenv.UI():IsFontAvailable(aa)end;for a9 in a7():lines()do if not a9:find("%.")then a9=a9:gsub(" Bold","")a9=a9:gsub(" Italic","")local aa=finale.FCString()aa.LuaString=a9;if a5[a9]or a8(a9)then a5[a9]=_ and"user"or"system"end end end end;a6(true)a6(false)return a5 end;function o.get_smufl_metadata_file(ab)if not ab then ab=finale.FCFontInfo()ab:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local ac=function(ad,ab)local ae=ad..ab.Name.."/"..ab.Name..".json"return io.open(ae,"r")end;local af=ac(Z(true),ab)if af then return af end;return ac(Z(false),ab)end;function o.is_font_smufl_font(ab)if not ab then ab=finale.FCFontInfo()ab:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=o.finale_version(27,1)then if nil~=ab.IsSMuFLFont then return ab.IsSMuFLFont end end;local ag=o.get_smufl_metadata_file(ab)if nil~=ag then io.close(ag)return true end;return false end;function o.simple_input(ah,ai)local aj=finale.FCString()aj.LuaString=""local ak=finale.FCString()local al=160;function format_ctrl(am,an,ao,ap)am:SetHeight(an)am:SetWidth(ao)ak.LuaString=ap;am:SetText(ak)end;title_width=string.len(ah)*6+54;if title_width>al then al=title_width end;text_width=string.len(ai)*6;if text_width>al then al=text_width end;ak.LuaString=ah;local aq=finale.FCCustomLuaWindow()aq:SetTitle(ak)local ar=aq:CreateStatic(0,0)format_ctrl(ar,16,al,ai)local as=aq:CreateEdit(0,20)format_ctrl(as,20,al,"")aq:CreateOkButton()aq:CreateCancelButton()function callback(am)end;aq:RegisterHandleCommand(callback)if aq:ExecuteModal(nil)==finale.EXECMODAL_OK then aj.LuaString=as:GetText(aj)return aj.LuaString end end;function o.is_finale_object(at)return at and type(at)=="userdata"and at.ClassName and at.GetClassID and true or false end;function o.system_indent_set_to_prefs(R,X)X=X or o.get_page_format_prefs()local au=finale.FCMeasure()local av=R.FirstMeasure==1;if not av and au:Load(R.FirstMeasure)then if au.ShowFullNames then av=true end end;if av and X.UseFirstSystemMargins then R.LeftMargin=X.FirstSystemLeft else R.LeftMargin=X.SystemLeft end;return R:Save()end;function o.calc_script_name(aw)local ax=finale.FCString()if finenv.RunningLuaFilePath then ax.LuaString=finenv.RunningLuaFilePath()else ax:SetRunningLuaFilePath()end;local ay=finale.FCString()ax:SplitToPathAndFile(nil,ay)local w=ay.LuaString;if not aw then w=w:match("(.+)%..+")if not w or w==""then w=ay.LuaString end end;return w end;return o end)return a("__root")