local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.RequireSelection=true;finaleplugin.Author="Robert Patterson"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.0"finaleplugin.Date="March 20, 2021"finaleplugin.CategoryTags="Expression"return"Expression Set To Parts Only","Expression Set To Parts Only","Set any single-staff text expression in the currenly selected region to Parts Only assignment."end;local o=require("library.general_library")local p=require("library.expression")function expression_set_to_parts_only()local q=o.get_current_part()local r=finale.FCExpressions()r:LoadAllForRegion(finenv.Region())for s in each(r)do if 0==s.StaffListID then if p.is_for_current_part(s,q)then s.ScoreAssignment=false;s.PartAssignment=true;s:Save()end end end end;expression_set_to_parts_only()end)c("library.expression",function(require,n,c,d)local o={}function o.finale_version(t,u,v)local w=bit32.bor(bit32.lshift(math.floor(t),24),bit32.lshift(math.floor(u),20))if v then w=bit32.bor(w,math.floor(v))end;return w end;function o.group_overlaps_region(x,y)if y:IsFullDocumentSpan()then return true end;local z=false;local A=finale.FCSystemStaves()A:LoadAllForRegion(y)for B in each(A)do if x:ContainsStaff(B:GetStaff())then z=true;break end end;if not z then return false end;if x.StartMeasure>y.EndMeasure or x.EndMeasure<y.StartMeasure then return false end;return true end;function o.group_is_contained_in_region(x,y)if not y:IsStaffIncluded(x.StartStaff)then return false end;if not y:IsStaffIncluded(x.EndStaff)then return false end;return true end;function o.staff_group_is_multistaff_instrument(x)local C=finale.FCMultiStaffInstruments()C:LoadAll()for D in each(C)do if D:ContainsStaff(x.StartStaff)and D.GroupID==x:GetItemID()then return true end end;return false end;function o.get_selected_region_or_whole_doc()local E=finenv.Region()if E:IsEmpty()then E:SetFullDocument()end;return E end;function o.get_first_cell_on_or_after_page(F)local G=F;local H=finale.FCPage()local I=false;while H:Load(G)do if H:GetFirstSystem()>0 then I=true;break end;G=G+1 end;if I then local J=finale.FCStaffSystem()J:Load(H:GetFirstSystem())return finale.FCCell(J.FirstMeasure,J.TopStaff)end;local K=finale.FCMusicRegion()K:SetFullDocument()return finale.FCCell(K.EndMeasure,K.EndStaff)end;function o.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local L=finale.FCMusicRegion()L:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),L.StartStaff)end;return o.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function o.get_top_left_selected_or_visible_cell()local E=finenv.Region()if not E:IsEmpty()then return finale.FCCell(E.StartMeasure,E.StartStaff)end;return o.get_top_left_visible_cell()end;function o.is_default_measure_number_visible_on_cell(M,N,O,P)local Q=finale.FCCurrentStaffSpec()if not Q:LoadForCell(N,0)then return false end;if M:GetShowOnTopStaff()and N.Staff==O.TopStaff then return true end;if M:GetShowOnBottomStaff()and N.Staff==O:CalcBottomStaff()then return true end;if Q.ShowMeasureNumbers then return not M:GetExcludeOtherStaves(P)end;return false end;function o.is_default_number_visible_and_left_aligned(M,N,R,P,S)if M.UseScoreInfoForParts then P=false end;if S and M:GetShowOnMultiMeasureRests(P)then if finale.MNALIGN_LEFT~=M:GetMultiMeasureAlignment(P)then return false end elseif N.Measure==R.FirstMeasure then if not M:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=M:GetStartAlignment(P)then return false end else if not M:GetShowMultiples(P)then return false end;if finale.MNALIGN_LEFT~=M:GetMultipleAlignment(P)then return false end end;return o.is_default_measure_number_visible_on_cell(M,N,R,P)end;function o.update_layout(T,U)T=T or 1;U=U or false;local V=finale.FCPage()if V:Load(T)then V:UpdateLayout(U)end end;function o.get_current_part()local W=finale.FCParts()W:LoadAll()return W:GetCurrent()end;function o.get_page_format_prefs()local q=o.get_current_part()local X=finale.FCPageFormatPrefs()local Y=false;if q:IsScore()then Y=X:LoadScore()else Y=X:LoadParts()end;return X,Y end;function o.get_smufl_metadata_file(Z)if not Z then Z=finale.FCFontInfo()Z:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local _=function(a0,Z)local a1=a0 .."/SMuFL/Fonts/"..Z.Name.."/"..Z.Name..".json"return io.open(a1,"r")end;local a2=""if finenv.UI():IsOnWindows()then a2=os.getenv("LOCALAPPDATA")else a2=os.getenv("HOME").."/Library/Application Support"end;local a3=_(a2,Z)if nil~=a3 then return a3 end;local a4="/Library/Application Support"if finenv.UI():IsOnWindows()then a4=os.getenv("COMMONPROGRAMFILES")end;return _(a4,Z)end;function o.is_font_smufl_font(Z)if not Z then Z=finale.FCFontInfo()Z:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=o.finale_version(27,1)then if nil~=Z.IsSMuFLFont then return Z.IsSMuFLFont end end;local a5=o.get_smufl_metadata_file(Z)if nil~=a5 then io.close(a5)return true end;return false end;function o.simple_input(a6,a7)local a8=finale.FCString()a8.LuaString=""local a9=finale.FCString()local aa=160;function format_ctrl(ab,ac,ad,ae)ab:SetHeight(ac)ab:SetWidth(ad)a9.LuaString=ae;ab:SetText(a9)end;title_width=string.len(a6)*6+54;if title_width>aa then aa=title_width end;text_width=string.len(a7)*6;if text_width>aa then aa=text_width end;a9.LuaString=a6;local af=finale.FCCustomLuaWindow()af:SetTitle(a9)local ag=af:CreateStatic(0,0)format_ctrl(ag,16,aa,a7)local ah=af:CreateEdit(0,20)format_ctrl(ah,20,aa,"")af:CreateOkButton()af:CreateCancelButton()function callback(ab)end;af:RegisterHandleCommand(callback)if af:ExecuteModal(nil)==finale.EXECMODAL_OK then a8.LuaString=ah:GetText(a8)return a8.LuaString end end;function o.is_finale_object(ai)return ai and type(ai)=="userdata"and ai.ClassName and ai.GetClassID and true or false end;function o.system_indent_set_to_prefs(R,X)X=X or o.get_page_format_prefs()local aj=finale.FCMeasure()local ak=R.FirstMeasure==1;if not ak and aj:Load(R.FirstMeasure)then if aj.ShowFullNames then ak=true end end;if ak and X.UseFirstSystemMargins then R.LeftMargin=X.FirstSystemLeft else R.LeftMargin=X.SystemLeft end;return R:Save()end;return o end)c("library.general_library",function(require,n,c,d)local o={}function o.finale_version(t,u,v)local w=bit32.bor(bit32.lshift(math.floor(t),24),bit32.lshift(math.floor(u),20))if v then w=bit32.bor(w,math.floor(v))end;return w end;function o.group_overlaps_region(x,y)if y:IsFullDocumentSpan()then return true end;local z=false;local A=finale.FCSystemStaves()A:LoadAllForRegion(y)for B in each(A)do if x:ContainsStaff(B:GetStaff())then z=true;break end end;if not z then return false end;if x.StartMeasure>y.EndMeasure or x.EndMeasure<y.StartMeasure then return false end;return true end;function o.group_is_contained_in_region(x,y)if not y:IsStaffIncluded(x.StartStaff)then return false end;if not y:IsStaffIncluded(x.EndStaff)then return false end;return true end;function o.staff_group_is_multistaff_instrument(x)local C=finale.FCMultiStaffInstruments()C:LoadAll()for D in each(C)do if D:ContainsStaff(x.StartStaff)and D.GroupID==x:GetItemID()then return true end end;return false end;function o.get_selected_region_or_whole_doc()local E=finenv.Region()if E:IsEmpty()then E:SetFullDocument()end;return E end;function o.get_first_cell_on_or_after_page(F)local G=F;local H=finale.FCPage()local I=false;while H:Load(G)do if H:GetFirstSystem()>0 then I=true;break end;G=G+1 end;if I then local J=finale.FCStaffSystem()J:Load(H:GetFirstSystem())return finale.FCCell(J.FirstMeasure,J.TopStaff)end;local K=finale.FCMusicRegion()K:SetFullDocument()return finale.FCCell(K.EndMeasure,K.EndStaff)end;function o.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local L=finale.FCMusicRegion()L:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),L.StartStaff)end;return o.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function o.get_top_left_selected_or_visible_cell()local E=finenv.Region()if not E:IsEmpty()then return finale.FCCell(E.StartMeasure,E.StartStaff)end;return o.get_top_left_visible_cell()end;function o.is_default_measure_number_visible_on_cell(M,N,O,P)local Q=finale.FCCurrentStaffSpec()if not Q:LoadForCell(N,0)then return false end;if M:GetShowOnTopStaff()and N.Staff==O.TopStaff then return true end;if M:GetShowOnBottomStaff()and N.Staff==O:CalcBottomStaff()then return true end;if Q.ShowMeasureNumbers then return not M:GetExcludeOtherStaves(P)end;return false end;function o.is_default_number_visible_and_left_aligned(M,N,R,P,S)if M.UseScoreInfoForParts then P=false end;if S and M:GetShowOnMultiMeasureRests(P)then if finale.MNALIGN_LEFT~=M:GetMultiMeasureAlignment(P)then return false end elseif N.Measure==R.FirstMeasure then if not M:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=M:GetStartAlignment(P)then return false end else if not M:GetShowMultiples(P)then return false end;if finale.MNALIGN_LEFT~=M:GetMultipleAlignment(P)then return false end end;return o.is_default_measure_number_visible_on_cell(M,N,R,P)end;function o.update_layout(T,U)T=T or 1;U=U or false;local V=finale.FCPage()if V:Load(T)then V:UpdateLayout(U)end end;function o.get_current_part()local W=finale.FCParts()W:LoadAll()return W:GetCurrent()end;function o.get_page_format_prefs()local q=o.get_current_part()local X=finale.FCPageFormatPrefs()local Y=false;if q:IsScore()then Y=X:LoadScore()else Y=X:LoadParts()end;return X,Y end;function o.get_smufl_metadata_file(Z)if not Z then Z=finale.FCFontInfo()Z:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local _=function(a0,Z)local a1=a0 .."/SMuFL/Fonts/"..Z.Name.."/"..Z.Name..".json"return io.open(a1,"r")end;local a2=""if finenv.UI():IsOnWindows()then a2=os.getenv("LOCALAPPDATA")else a2=os.getenv("HOME").."/Library/Application Support"end;local a3=_(a2,Z)if nil~=a3 then return a3 end;local a4="/Library/Application Support"if finenv.UI():IsOnWindows()then a4=os.getenv("COMMONPROGRAMFILES")end;return _(a4,Z)end;function o.is_font_smufl_font(Z)if not Z then Z=finale.FCFontInfo()Z:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=o.finale_version(27,1)then if nil~=Z.IsSMuFLFont then return Z.IsSMuFLFont end end;local a5=o.get_smufl_metadata_file(Z)if nil~=a5 then io.close(a5)return true end;return false end;function o.simple_input(a6,a7)local a8=finale.FCString()a8.LuaString=""local a9=finale.FCString()local aa=160;function format_ctrl(ab,ac,ad,ae)ab:SetHeight(ac)ab:SetWidth(ad)a9.LuaString=ae;ab:SetText(a9)end;title_width=string.len(a6)*6+54;if title_width>aa then aa=title_width end;text_width=string.len(a7)*6;if text_width>aa then aa=text_width end;a9.LuaString=a6;local af=finale.FCCustomLuaWindow()af:SetTitle(a9)local ag=af:CreateStatic(0,0)format_ctrl(ag,16,aa,a7)local ah=af:CreateEdit(0,20)format_ctrl(ah,20,aa,"")af:CreateOkButton()af:CreateCancelButton()function callback(ab)end;af:RegisterHandleCommand(callback)if af:ExecuteModal(nil)==finale.EXECMODAL_OK then a8.LuaString=ah:GetText(a8)return a8.LuaString end end;function o.is_finale_object(ai)return ai and type(ai)=="userdata"and ai.ClassName and ai.GetClassID and true or false end;function o.system_indent_set_to_prefs(R,X)X=X or o.get_page_format_prefs()local aj=finale.FCMeasure()local ak=R.FirstMeasure==1;if not ak and aj:Load(R.FirstMeasure)then if aj.ShowFullNames then ak=true end end;if ak and X.UseFirstSystemMargins then R.LeftMargin=X.FirstSystemLeft else R.LeftMargin=X.SystemLeft end;return R:Save()end;return o end)return a("__root")