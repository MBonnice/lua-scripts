local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.Author="Robert Patterson"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.0"finaleplugin.Date="July 7, 2021"finaleplugin.CategoryTags="Measure"return"Measure Numbers Reset Vertical","Measure Numbers Reset Vertical","Reset vertical position to default for selected measure numbers."end;local o=require("library.general_library")function measure_numbers_reset_vertical()local p=finale.FCStaffSystems()p:LoadAll()local q=finale.FCMeasureNumberRegions()q:LoadAll()local r=finale.FCParts()r:LoadAll()local s=r:GetCurrent()local t=not s:IsScore()local u=o.get_selected_region_or_whole_doc()local v=finale.FCCells()v:ApplyRegion(u)for w in each(v)do local x=p:FindMeasureNumber(w.Measure)local y=q:FindMeasure(w.Measure)if nil~=x and nil~=y then if o.is_default_measure_number_visible_on_cell(y,w,x,t)then local z=finale.FCSeparateMeasureNumbers()z:LoadAllInCell(w)if z.Count>0 then for A in each(z)do A.VerticalPosition=0;A:Save()end end end end end end;measure_numbers_reset_vertical()end)c("library.general_library",function(require,n,c,d)local o={}function o.finale_version(B,C,D)local E=bit32.bor(bit32.lshift(math.floor(B),24),bit32.lshift(math.floor(C),20))if D then E=bit32.bor(E,math.floor(D))end;return E end;function o.group_overlaps_region(F,G)if G:IsFullDocumentSpan()then return true end;local H=false;local I=finale.FCSystemStaves()I:LoadAllForRegion(G)for J in each(I)do if F:ContainsStaff(J:GetStaff())then H=true;break end end;if not H then return false end;if F.StartMeasure>G.EndMeasure or F.EndMeasure<G.StartMeasure then return false end;return true end;function o.group_is_contained_in_region(F,G)if not G:IsStaffIncluded(F.StartStaff)then return false end;if not G:IsStaffIncluded(F.EndStaff)then return false end;return true end;function o.staff_group_is_multistaff_instrument(F)local K=finale.FCMultiStaffInstruments()K:LoadAll()for L in each(K)do if L:ContainsStaff(F.StartStaff)and L.GroupID==F:GetItemID()then return true end end;return false end;function o.get_selected_region_or_whole_doc()local u=finenv.Region()if u:IsEmpty()then u:SetFullDocument()end;return u end;function o.get_first_cell_on_or_after_page(M)local N=M;local O=finale.FCPage()local P=false;while O:Load(N)do if O:GetFirstSystem()>0 then P=true;break end;N=N+1 end;if P then local Q=finale.FCStaffSystem()Q:Load(O:GetFirstSystem())return finale.FCCell(Q.FirstMeasure,Q.TopStaff)end;local R=finale.FCMusicRegion()R:SetFullDocument()return finale.FCCell(R.EndMeasure,R.EndStaff)end;function o.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local S=finale.FCMusicRegion()S:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),S.StartStaff)end;return o.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function o.get_top_left_selected_or_visible_cell()local u=finenv.Region()if not u:IsEmpty()then return finale.FCCell(u.StartMeasure,u.StartStaff)end;return o.get_top_left_visible_cell()end;function o.is_default_measure_number_visible_on_cell(y,w,T,t)local U=finale.FCCurrentStaffSpec()if not U:LoadForCell(w,0)then return false end;if y:GetShowOnTopStaff()and w.Staff==T.TopStaff then return true end;if y:GetShowOnBottomStaff()and w.Staff==T:CalcBottomStaff()then return true end;if U.ShowMeasureNumbers then return not y:GetExcludeOtherStaves(t)end;return false end;function o.is_default_number_visible_and_left_aligned(y,w,x,t,V)if y.UseScoreInfoForParts then t=false end;if V and y:GetShowOnMultiMeasureRests(t)then if finale.MNALIGN_LEFT~=y:GetMultiMeasureAlignment(t)then return false end elseif w.Measure==x.FirstMeasure then if not y:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=y:GetStartAlignment(t)then return false end else if not y:GetShowMultiples(t)then return false end;if finale.MNALIGN_LEFT~=y:GetMultipleAlignment(t)then return false end end;return o.is_default_measure_number_visible_on_cell(y,w,x,t)end;function o.update_layout(W,X)W=W or 1;X=X or false;local Y=finale.FCPage()if Y:Load(W)then Y:UpdateLayout(X)end end;function o.get_current_part()local r=finale.FCParts()r:LoadAll()return r:GetCurrent()end;function o.get_page_format_prefs()local s=o.get_current_part()local Z=finale.FCPageFormatPrefs()local _=false;if s:IsScore()then _=Z:LoadScore()else _=Z:LoadParts()end;return Z,_ end;local a0=function(a1)local a2=finenv.UI():IsOnWindows()local a3=function(a4,a5)if finenv.UI():IsOnWindows()then return a4 and os.getenv(a4)or""else return a5 and os.getenv(a5)or""end end;local a6=a1 and a3("LOCALAPPDATA","HOME")or a3("COMMONPROGRAMFILES")if not a2 then a6=a6 .."/Library/Application Support"end;a6=a6 .."/SMuFL/Fonts/"return a6 end;function o.get_smufl_font_list()local a7={}local a8=function(a1)local a6=a0(a1)local a9=function()if finenv.UI():IsOnWindows()then return io.popen('dir "'..a6 ..'" /b /ad')else return io.popen('ls "'..a6 ..'"')end end;local aa=function(ab)local ac=finale.FCString()ac.LuaString=ab;return finenv.UI():IsFontAvailable(ac)end;for ab in a9():lines()do if not ab:find("%.")then ab=ab:gsub(" Bold","")ab=ab:gsub(" Italic","")local ac=finale.FCString()ac.LuaString=ab;if a7[ab]or aa(ab)then a7[ab]=a1 and"user"or"system"end end end end;a8(true)a8(false)return a7 end;function o.get_smufl_metadata_file(ad)if not ad then ad=finale.FCFontInfo()ad:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local ae=function(af,ad)local ag=af..ad.Name.."/"..ad.Name..".json"return io.open(ag,"r")end;local ah=ae(a0(true),ad)if ah then return ah end;return ae(a0(false),ad)end;function o.is_font_smufl_font(ad)if not ad then ad=finale.FCFontInfo()ad:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=o.finale_version(27,1)then if nil~=ad.IsSMuFLFont then return ad.IsSMuFLFont end end;local ai=o.get_smufl_metadata_file(ad)if nil~=ai then io.close(ai)return true end;return false end;function o.simple_input(aj,ak)local al=finale.FCString()al.LuaString=""local am=finale.FCString()local an=160;function format_ctrl(ao,ap,aq,ar)ao:SetHeight(ap)ao:SetWidth(aq)am.LuaString=ar;ao:SetText(am)end;title_width=string.len(aj)*6+54;if title_width>an then an=title_width end;text_width=string.len(ak)*6;if text_width>an then an=text_width end;am.LuaString=aj;local as=finale.FCCustomLuaWindow()as:SetTitle(am)local at=as:CreateStatic(0,0)format_ctrl(at,16,an,ak)local au=as:CreateEdit(0,20)format_ctrl(au,20,an,"")as:CreateOkButton()as:CreateCancelButton()function callback(ao)end;as:RegisterHandleCommand(callback)if as:ExecuteModal(nil)==finale.EXECMODAL_OK then al.LuaString=au:GetText(al)return al.LuaString end end;function o.is_finale_object(av)return av and type(av)=="userdata"and av.ClassName and av.GetClassID and true or false end;function o.system_indent_set_to_prefs(x,Z)Z=Z or o.get_page_format_prefs()local aw=finale.FCMeasure()local ax=x.FirstMeasure==1;if not ax and aw:Load(x.FirstMeasure)then if aw.ShowFullNames then ax=true end end;if ax and Z.UseFirstSystemMargins then x.LeftMargin=Z.FirstSystemLeft else x.LeftMargin=Z.SystemLeft end;return x:Save()end;function o.calc_script_name(ay)local az=finale.FCString()if finenv.RunningLuaFilePath then az.LuaString=finenv.RunningLuaFilePath()else az:SetRunningLuaFilePath()end;local aA=finale.FCString()az:SplitToPathAndFile(nil,aA)local E=aA.LuaString;if not ay then E=E:match("(.+)%..+")if not E or E==""then E=aA.LuaString end end;return E end;return o end)return a("__root")