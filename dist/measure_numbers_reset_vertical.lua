local a,b,c,d=(function(e)local f={[{}]=true}local g;local h={}local require;local i={}g=function(j,k)if not h[j]then h[j]=k end end;require=function(j)local l=i[j]if l then if l==f then return nil end else if not h[j]then if not e then local m=type(j)=='string'and'\"'..j..'\"'or tostring(j)error('Tried to require '..m..', but no such module has been registered')else return e(j)end end;i[j]=f;l=h[j](require,i,g,h)i[j]=l end;return l end;return require,i,g,h end)(require)c("__root",function(require,n,c,d)function plugindef()finaleplugin.Author="Robert Patterson"finaleplugin.Copyright="CC0 https://creativecommons.org/publicdomain/zero/1.0/"finaleplugin.Version="1.0"finaleplugin.Date="July 7, 2021"finaleplugin.CategoryTags="Measure"return"Measure Numbers Reset Vertical","Measure Numbers Reset Vertical","Reset vertical position to default for selected measure numbers."end;local o=require("library.general_library")function measure_numbers_reset_vertical()local p=finale.FCStaffSystems()p:LoadAll()local q=finale.FCMeasureNumberRegions()q:LoadAll()local r=finale.FCParts()r:LoadAll()local s=r:GetCurrent()local t=not s:IsScore()local u=o.get_selected_region_or_whole_doc()local v=finale.FCCells()v:ApplyRegion(u)for w in each(v)do local x=p:FindMeasureNumber(w.Measure)local y=q:FindMeasure(w.Measure)if nil~=x and nil~=y then if o.is_default_measure_number_visible_on_cell(y,w,x,t)then local z=finale.FCSeparateMeasureNumbers()z:LoadAllInCell(w)if z.Count>0 then for A in each(z)do A.VerticalPosition=0;A:Save()end end end end end end;measure_numbers_reset_vertical()end)c("library.general_library",function(require,n,c,d)local o={}function o.finale_version(B,C,D)local E=bit32.bor(bit32.lshift(math.floor(B),24),bit32.lshift(math.floor(C),20))if D then E=bit32.bor(E,math.floor(D))end;return E end;function o.group_overlaps_region(F,G)if G:IsFullDocumentSpan()then return true end;local H=false;local I=finale.FCSystemStaves()I:LoadAllForRegion(G)for J in each(I)do if F:ContainsStaff(J:GetStaff())then H=true;break end end;if not H then return false end;if F.StartMeasure>G.EndMeasure or F.EndMeasure<G.StartMeasure then return false end;return true end;function o.group_is_contained_in_region(F,G)if not G:IsStaffIncluded(F.StartStaff)then return false end;if not G:IsStaffIncluded(F.EndStaff)then return false end;return true end;function o.staff_group_is_multistaff_instrument(F)local K=finale.FCMultiStaffInstruments()K:LoadAll()for L in each(K)do if L:ContainsStaff(F.StartStaff)and L.GroupID==F:GetItemID()then return true end end;return false end;function o.get_selected_region_or_whole_doc()local u=finenv.Region()if u:IsEmpty()then u:SetFullDocument()end;return u end;function o.get_first_cell_on_or_after_page(M)local N=M;local O=finale.FCPage()local P=false;while O:Load(N)do if O:GetFirstSystem()>0 then P=true;break end;N=N+1 end;if P then local Q=finale.FCStaffSystem()Q:Load(O:GetFirstSystem())return finale.FCCell(Q.FirstMeasure,Q.TopStaff)end;local R=finale.FCMusicRegion()R:SetFullDocument()return finale.FCCell(R.EndMeasure,R.EndStaff)end;function o.get_top_left_visible_cell()if not finenv.UI():IsPageView()then local S=finale.FCMusicRegion()S:SetFullDocument()return finale.FCCell(finenv.UI():GetCurrentMeasure(),S.StartStaff)end;return o.get_first_cell_on_or_after_page(finenv.UI():GetCurrentPage())end;function o.get_top_left_selected_or_visible_cell()local u=finenv.Region()if not u:IsEmpty()then return finale.FCCell(u.StartMeasure,u.StartStaff)end;return o.get_top_left_visible_cell()end;function o.is_default_measure_number_visible_on_cell(y,w,T,t)local U=finale.FCCurrentStaffSpec()if not U:LoadForCell(w,0)then return false end;if y:GetShowOnTopStaff()and w.Staff==T.TopStaff then return true end;if y:GetShowOnBottomStaff()and w.Staff==T:CalcBottomStaff()then return true end;if U.ShowMeasureNumbers then return not y:GetExcludeOtherStaves(t)end;return false end;function o.is_default_number_visible_and_left_aligned(y,w,x,t,V)if y.UseScoreInfoForParts then t=false end;if V and y:GetShowOnMultiMeasureRests(t)then if finale.MNALIGN_LEFT~=y:GetMultiMeasureAlignment(t)then return false end elseif w.Measure==x.FirstMeasure then if not y:GetShowOnSystemStart()then return false end;if finale.MNALIGN_LEFT~=y:GetStartAlignment(t)then return false end else if not y:GetShowMultiples(t)then return false end;if finale.MNALIGN_LEFT~=y:GetMultipleAlignment(t)then return false end end;return o.is_default_measure_number_visible_on_cell(y,w,x,t)end;function o.update_layout(W,X)W=W or 1;X=X or false;local Y=finale.FCPage()if Y:Load(W)then Y:UpdateLayout(X)end end;function o.get_current_part()local r=finale.FCParts()r:LoadAll()return r:GetCurrent()end;function o.get_page_format_prefs()local s=o.get_current_part()local Z=finale.FCPageFormatPrefs()local _=false;if s:IsScore()then _=Z:LoadScore()else _=Z:LoadParts()end;return Z,_ end;function o.get_smufl_metadata_file(a0)if not a0 then a0=finale.FCFontInfo()a0:LoadFontPrefs(finale.FONTPREF_MUSIC)end;local a1=function(a2,a0)local a3=a2 .."/SMuFL/Fonts/"..a0.Name.."/"..a0.Name..".json"return io.open(a3,"r")end;local a4=""if finenv.UI():IsOnWindows()then a4=os.getenv("LOCALAPPDATA")else a4=os.getenv("HOME").."/Library/Application Support"end;local a5=a1(a4,a0)if nil~=a5 then return a5 end;local a6="/Library/Application Support"if finenv.UI():IsOnWindows()then a6=os.getenv("COMMONPROGRAMFILES")end;return a1(a6,a0)end;function o.is_font_smufl_font(a0)if not a0 then a0=finale.FCFontInfo()a0:LoadFontPrefs(finale.FONTPREF_MUSIC)end;if finenv.RawFinaleVersion>=o.finale_version(27,1)then if nil~=a0.IsSMuFLFont then return a0.IsSMuFLFont end end;local a7=o.get_smufl_metadata_file(a0)if nil~=a7 then io.close(a7)return true end;return false end;function o.simple_input(a8,a9)local aa=finale.FCString()aa.LuaString=""local ab=finale.FCString()local ac=160;function format_ctrl(ad,ae,af,ag)ad:SetHeight(ae)ad:SetWidth(af)ab.LuaString=ag;ad:SetText(ab)end;title_width=string.len(a8)*6+54;if title_width>ac then ac=title_width end;text_width=string.len(a9)*6;if text_width>ac then ac=text_width end;ab.LuaString=a8;local ah=finale.FCCustomLuaWindow()ah:SetTitle(ab)local ai=ah:CreateStatic(0,0)format_ctrl(ai,16,ac,a9)local aj=ah:CreateEdit(0,20)format_ctrl(aj,20,ac,"")ah:CreateOkButton()ah:CreateCancelButton()function callback(ad)end;ah:RegisterHandleCommand(callback)if ah:ExecuteModal(nil)==finale.EXECMODAL_OK then aa.LuaString=aj:GetText(aa)return aa.LuaString end end;function o.is_finale_object(ak)return ak and type(ak)=="userdata"and ak.ClassName and ak.GetClassID and true or false end;function o.system_indent_set_to_prefs(x,Z)Z=Z or o.get_page_format_prefs()local al=finale.FCMeasure()local am=x.FirstMeasure==1;if not am and al:Load(x.FirstMeasure)then if al.ShowFullNames then am=true end end;if am and Z.UseFirstSystemMargins then x.LeftMargin=Z.FirstSystemLeft else x.LeftMargin=Z.SystemLeft end;return x:Save()end;return o end)return a("__root")